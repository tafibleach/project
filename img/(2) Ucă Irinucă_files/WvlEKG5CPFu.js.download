if (self.CavalryLogger) { CavalryLogger.start_js(["+4sWy"]); }

/**
 * @providesModule Shaka
 * @preserve-whitespace
 * @nopackage
 * @generated
 */
__d("Shaka",["Promise","VideoPlayerShakaPerformanceLogger","VideoPushParametersHelper","TimeSlice","Map","VideoPlayerLocalBandwidthEstimator","VideoPlayerShakaExperiments","VideoPlayerResourceTimer","SegmentRequestManager","logLongAkamaiRequest","throttle","ViewportPriorityAdjuster","VideoPriorityCalculator","setTimeoutAcrossTransitions","setTimeout","setImmediateAcrossTransitions","setImmediate","clearTimeout","clearImmediate","extractCEA608","performanceNow"],(function $module_Shaka(global,require,requireDynamic,requireLazy,module,exports){

var Promise = require('Promise');
var VideoPlayerShakaPerformanceLogger = require('VideoPlayerShakaPerformanceLogger');
var VideoPushParametersHelper = require('VideoPushParametersHelper');
var TimeSlice = require('TimeSlice');
var Map = require('Map');
var VideoPlayerLocalBandwidthEstimator = require('VideoPlayerLocalBandwidthEstimator');
var VideoPlayerShakaExperiments = require('VideoPlayerShakaExperiments');
var VideoPlayerResourceTimer = require('VideoPlayerResourceTimer');
var SegmentRequestManager = require('SegmentRequestManager');
var logLongAkamaiRequest = require('logLongAkamaiRequest');
var throttle = require('throttle');
var ViewportPriorityAdjuster = require('ViewportPriorityAdjuster');
var VideoPriorityCalculator = require('VideoPriorityCalculator');

var setTimeout = VideoPlayerShakaExperiments.timeoutsPersistOnPageTransition
  ? require('setTimeoutAcrossTransitions') : require('setTimeout');
var setImmediate = VideoPlayerShakaExperiments.timeoutsPersistOnPageTransition
  ? require('setImmediateAcrossTransitions') : require('setImmediate');

var clearTimeout = require('clearTimeout');
var clearImmediate = require('clearImmediate');

var extractCEA608 = require('extractCEA608');
var performanceNow = require('performanceNow');

function setEventProperty(obj, name, handler) {
  obj[name] = TimeSlice.guard(handler, 'shaka ' + name);
};

if (
  VideoPlayerShakaExperiments.shakaNativePromise &&
  VideoPlayerShakaExperiments.useNativePromise
) {
  Promise = window.Promise;
}

var g = {};

(function(window){var n,aa=this;function p(a,b){var c=a.split("."),d=aa;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d[e]?d=d[e]:d=d[e]={}:d[e]=b}function q(a,b){function c(){}c.prototype=b.prototype;a.vc=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.tc=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}};/*

 Copyright 2015 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function ba(){};function da(){}function ea(a){var b=console[a];b?b.bind||(console[a]=function(){b.apply(console,arguments)}):console[a]=function(){}}ea("error");ea("warn");ea("info");ea("log");ea("debug");function fa(a){ga[a]={sa:ha(),end:NaN}}function ia(a){if(a=ga[a])a.end=ha()}function ja(){var a=ga.buffering;return a&&a.end?a.end-a.sa:NaN}var ha=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now,ga={};function ka(a,b,c,d){this.id=a;this.bandwidth=b||0;this.lang=c||"unknown";this.streamInfoID=d;this.active=!1}p("shaka.player.AudioTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0});function la(){this.minBandwidth=this.maxBandwidth=this.maxWidth=this.minHeight=this.maxHeight=null}la.prototype.clone=function(){var a=new la;a.maxHeight=this.maxHeight;a.minHeight=this.minHeight;a.maxWidth=this.maxWidth;a.maxBandwidth=this.maxBandwidth;a.minBandwidth=this.minBandwidth;return a};function ma(){this.fontSize="100%";this.fontColor=na;this.fontOpacity=oa;this.backgroundColor=pa;this.backgroundOpacity=oa;this.fontEdge=qa}p("shaka.player.TextStyle",ma);
function ra(a){var b=[];b.push("font-size: "+a.fontSize);b.push("color: "+sa(a.fontColor,a.fontOpacity));b.push("background-color: "+sa(a.backgroundColor,a.backgroundOpacity));for(var c=[],d=0;d<a.fontEdge.length;++d){var e=a.fontEdge[d].slice(3,6);c.push(sa(a.fontEdge[d].slice(0,3),a.fontOpacity)+" "+e.join("px ")+"px")}b.push("text-shadow: "+c.join(","));return b.join("; ")}function sa(a,b){return"rgba("+a.concat(b).join(",")+")"}var na=[255,255,255],pa=[0,0,0];
ma.StandardColors={WHITE:na,BLACK:pa,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var oa=1;ma.StandardOpacities={OPAQUE:oa,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var qa=[];
ma.EdgeStyles={NONE:qa,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};function ta(a,b){this.id=a;this.lang=b||"unknown";this.enabled=this.active=!1}p("shaka.player.TextTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:0});function ua(a,b,c,d,e,f,h,g){this.id=a;this.bandwidth=b||0;this.width=c||0;this.height=d||0;this.streamInfoID=e;this.fbQualityLabel=f;this.fbQualityClass=h;a=[];g&&(a=g.split(","));this.isHVQ=-1<a.indexOf("hvq");this.isInlineHVQ=-1<a.indexOf("hvq_www_inline");this.active=!1}function va(a,b){var c=a.width*a.height,d=b.width*b.height;return c<d?-1:c>d?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0}p("shaka.player.VideoTrack.compare",va);function wa(a){for(var b=xa,c=[],d=0;d<a.length;++d){for(var e=!1,f=0;f<c.length&&!(e=b?b(a[d],c[f]):a[d]===c[f]);++f);e||c.push(a[d])}return c};function ya(){return Date.now()+za}var za=0;function Aa(a){this.b=a;this.c=0==Ba;this.a=0}var Ba=1;function Ca(a){return a.a<a.b.byteLength}function Da(a){var b=a.b.getUint8(a.a);a.a+=1;return b}function r(a){var b=a.b.getUint32(a.a,a.c);a.a+=4;return b}function Fa(a){var b,c;a.c?(b=a.b.getUint32(a.a,!0),c=a.b.getUint32(a.a+4,!0)):(c=a.b.getUint32(a.a,!1),b=a.b.getUint32(a.a+4,!1));if(2097151<c)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");a.a+=8;return c*Math.pow(2,32)+b}
function Ga(a){if(a.a+16>a.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var b=new Uint8Array(a.b.buffer,a.a,16);a.a+=16;return b}function u(a,b){if(a.a+b>a.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");a.a+=b};function Ha(a){this.b=a;this.a=new Aa(a);Ia||(Ia=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var Ia;
function w(a){var b;b=Ja(a);if(7<b.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var c=0,d=0;d<b.length;d++)c=256*c+b[d];b=c;c=Ja(a);a:{for(d=0;d<Ia.length;d++)if(Ka(c,Ia[d])){d=!0;break a}d=!1}if(d)c=a.b.byteLength-a.a.a;else{if(8==c.length&&c[1]&224)throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var d=c[0]&(1<<8-c.length)-1,e=1;e<c.length;e++)d=256*d+c[e];c=d}c=a.a.a+c<=a.b.byteLength?c:a.b.byteLength-a.a.a;d=new DataView(a.b.buffer,
a.b.byteOffset+a.a.a,c);u(a.a,c);return new La(b,d)}function Ja(a){var b=Da(a.a),c;for(c=1;8>=c&&!(b&1<<8-c);c++);if(8<c)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var d=new Uint8Array(c);d[0]=b;for(b=1;b<c;b++)d[b]=Da(a.a);return d}function La(a,b){this.id=a;this.a=b}
function Ma(a){if(8<a.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==a.a.byteLength&&a.a.getUint8(0)&224)throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var b=0,c=0;c<a.a.byteLength;c++)var d=a.a.getUint8(c),b=256*b+d;return b};function Na(a){this.f=Math.exp(Math.log(.5)/a);this.c=this.a=this.b=0}Na.prototype.sample=function(a,b){var c=Math.pow(this.f,a);this.b=b*(1-c)+c*this.b;this.a+=a;this.c+=1};function Oa(a){return a.b/(1-Math.pow(a.f,a.a))};var Pa=window.CustomEvent;"function"!==typeof Pa&&(Pa=function(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail);return c},Pa.prototype=window.Event.prototype);function x(a){var b=new Pa(a.type,{detail:a.detail,bubbles:!!a.bubbles}),c;for(c in a)c in b||(b[c]=a[c]);return b}function y(a){return new Pa("error",{detail:a,bubbles:!0})};function Qa(a,b,c){Ra(b);Ra(c);return c==b||a>=Sa&&c==b.split("-")[0]||a>=Ta&&c.split("-")[0]==b.split("-")[0]?!0:!1}var Sa=1,Ta=2;function Ra(a){a=a.toLowerCase().split("-");var b=Ua[a[0]];b&&(a[0]=b);return a.join("-")}
var Ua={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",
fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",
lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",
srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};function Va(a){return Object.keys(a).map(function(b){return a[b]})}function z(a,b){return Wa(a,b,"boolean")}function A(a,b,c){a=Wa(a,b,"number");if(null==a)return null;if(isNaN(a)||a==Number.NEGATIVE_INFINITY||a==Number.POSITIVE_INFINITY)throw new RangeError("'"+b+"' must be finite.");if(null!=c&&a<c)throw new RangeError("'"+b+"' must be >= "+c);return a}function Ya(a,b){return Wa(a,b,"string")}
function Wa(a,b,c){a=a[b];if(null==a)return null;if(typeof a!=c)throw new TypeError("'"+b+"' must be a "+c+".");return a}function Za(a,b,c){a=a[b];if(null==a)return null;if(!(a instanceof c))throw new TypeError("'"+b+"' must be an instance of "+c.name+".");return a};function B(){this.a={}}B.prototype.push=function(a,b){this.a.hasOwnProperty(a)?this.a[a].push(b):this.a[a]=[b]};B.prototype.set=function(a,b){this.a[a]=b};B.prototype.get=function(a){return(a=this.a[a])?a.slice():null};function $a(a){var b=[],c;for(c in a.a)b.push.apply(b,a.a[c]);return b}function ab(a,b,c){if(a=a.a[b])for(b=0;b<a.length;++b)a[b]==c&&(a.splice(b,1),--b)}function bb(a){var b=[],c;for(c in a.a)b.push(c);return b};function cb(){this.a=new B}cb.prototype.destroy=function(){db(this);this.a=null};function C(a,b,c,d){b=new eb(b,c,d);a.a.push(c,b)}cb.prototype.za=function(a,b){for(var c=this.a.get(b)||[],d=0;d<c.length;++d){var e=c[d];e.target==a&&(e.za(),ab(this.a,b,e))}};function db(a){for(var b=$a(a.a),c=0;c<b.length;++c)b[c].za();a.a.a={}}function eb(a,b,c){this.target=a;this.type=b;this.a=c;this.target.addEventListener(b,c,!1)}
eb.prototype.za=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)};function F(a){this.Ha=new B;this.oa=a}p("shaka.util.FakeEventTarget",F);n=F.prototype;n.addEventListener=function(a,b){this.Ha.push(a,b)};n.removeEventListener=function(a,b){ab(this.Ha,a,b)};
n.dispatchEvent=function(a){a.hasOwnProperty("srcElement")||(delete a.srcElement,Object.defineProperty(a,"srcElement",{get:function(){return null}}));if(a.hasOwnProperty("target"))a.target=this;else{delete a.target;var b=this;Object.defineProperty(a,"target",{get:function(){return b},set:function(a){b=a}})}if(a.hasOwnProperty("currentTarget"))a.currentTarget=null;else{delete a.currentTarget;var c=null;Object.defineProperty(a,"currentTarget",{get:function(){return c},set:function(a){c=a}})}return fb(this,
a)};n.gb=!1;n.ja=function(a,b){return this.dispatchEvent(x({type:"debug/shakaEvent",bubbles:!0,detail:{type:a,event:b}}))};function fb(a,b){b.currentTarget=a;for(var c=a.Ha.get(b.type)||[],d=0;d<c.length;++d){var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(a,b)}catch(f){}}a.oa&&b.bubbles&&fb(a.oa,b);return b.defaultPrevented};function G(a,b,c){F.call(this,null);this.b=a;this.c=null;this.f=new cb;this.h=null;this.B=0;this.w=null;this.g=!1;this.F=this.G=!0;this.j=!1;this.a={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:0,mpdRequestTimeout:0,segmentRequestTimeout:0,preferredLanguage:"en",restrictions:new la};this.m=b;this.u=c;this.i=null;this.l=1;this.C=null;this.o=!1}q(G,F);p("shaka.player.Player",G);G.version="v1.6.4-fb";
G.isBrowserSupported=function(){return!!window.MediaSource&&!!window.Uint8Array};
G.prototype.ga=function(){var a={},b=this.c;if(b){var c=b.wb();a.BandwidthEstimator=c.BandwidthEstimator;var d=c.VideoSourceStream;d&&(a.VideoSourceStream=d,(d=a.VideoBufferManager=d.ga().SourceBufferManager)&&(a.VideoSourceBuffer=d.ga().SourceBuffer));(d=a.AudioSourceStream=c.AudioSourceStream)&&(d=a.AudioBufferManager=d.ga().SourceBufferManager)&&(a.AudioSourceBuffer=d.ga().SourceBuffer);a.TextSourceStream=c.TextSourceStream;a.getManifest=b.pb.bind(b)}else a.getManifest=function(){};a.uc=!0;return a};
G.prototype.getDebug=G.prototype.ga;G.prototype.O=function(a){this.G=a};G.prototype.setResumeAfterBuffering=G.prototype.O;function gb(a){return"text/vtt"==a?!!window.VTTCue:MediaSource.isTypeSupported(a)}G.isTypeSupported=gb;G.setTextStyle=function(a){var b=document.getElementById("ShakaPlayerTextStyle");b||(b=document.createElement("style"),b.id="ShakaPlayerTextStyle",document.head.appendChild(b));for(b=b.sheet;b.cssRules.length;)b.deleteRule(0);b.insertRule("::cue { "+ra(a)+" }",0)};
G.prototype.destroy=function(){return this.D().then(H(this,function(){this.f.destroy();this.b=this.f=null})).catch(function(){})};G.prototype.destroy=G.prototype.destroy;G.prototype.D=function(){this.j=!0;return hb(this)};G.prototype.unload=G.prototype.D;
function hb(a){var b;a.m&&(b=a.m.getOperationLogger("unload").start());if(!a.c)return b&&b.log(),Promise.resolve();a.g&&ib(a);a.b.pause();db(a.f);jb(a);kb(a);a.c&&(a.c.destroy(),a.c=null);a.b.src="";var c=Promise.resolve().then(function(){b&&b.log()});a.g=!1;return c}G.prototype.$=function(a){return lb(this,a)};G.prototype.load=G.prototype.$;
function lb(a,b){var c;a.m&&(c=a.m.getOperationLogger("load").setState("loading").start(),b.m=b.g.performanceLogger=a.m);a.u&&(b.cb=b.g.abrLogger=a.u);mb(b,a.b);var d=null;a.j=!1;a.c&&(d=hb(a).then(H(a,function(){return b.Ea()})));a.b.autoplay&&(fa("load"),C(a.f,a.b,"timeupdate",a.bc.bind(a)));b.$a(a.a);b.T=a.C;a.C=null;d||(d=b.Ea());d.catch(H(a,function(a){b.destroy();return Promise.reject(a)}));return d.then(H(a,function(){if(!this.b||this.j)return nb();this.c=b;C(this.f,this.c,"seekrangechanged",
this.hc.bind(this));var a=new B,c;c=this.c;if(c.C){c=c.a.a[0];for(var d=[],g=0;g<c.a.length;++g)d.push.apply(d,ob(c.a[g]));c=d}else c=[];for(d=0;d<c.length;d++)a.push(c[d].contentType,c[d]);c=this.c;if(c.C){for(var d={},l=c.a.a[0],g=0;g<l.a.length;++g){var k=l.a[g];d[k.K]=k}c.f.a={};l=bb(a);for(g=0;g<l.length;++g){var k=l[g],m=a.get(k);if("video"==k){var t=m[0].id;c.f.push(k,d[t])}else if("audio"==k)for(var t=m[0].a.split(";")[0],v=0;v<m.length;++v){var D=m[v];D.a.split(";")[0]==t&&c.f.push(k,d[D.id])}else for(v=
0;v<m.length;++v)t=m[v].id,c.f.push(k,d[t])}c.ha=!0;if(a=c.f.get("audio"))pb(c,a),c.f.set("audio",a),a=a[0].lang||c.F,Qa(2,c.F,a)&&(c.ha=!1);if(a=c.f.get("text"))pb(c,a),c.f.set("text",a),a=a[0].lang||c.F,Qa(2,c.F,a)||(c.ha=!1)}C(this.f,this.b,"error",this.pc.bind(this));C(this.f,this.b,"playing",this.gc.bind(this));C(this.f,this.b,"pause",this.ec.bind(this));return qb(this.c,this,this.b)})).then(H(a,function(){if(!this.b||this.j)return nb();rb(this);c&&c.updateState("ready").log()})).catch(H(a,function(a){c&&
c.setError(JSON.stringify(a)).log();if(!this.b||this.j)return nb();if("destroy"!=a.type){var b=y(a);this.dispatchEvent(b)}return this.D().then(function(){return Promise.reject(a)})}))}function nb(){var a=Error("Player destroyed");a.type="destroy";return Promise.reject(a)}n=G.prototype;n.bc=function(){ia("load");this.f.za(this.b,"timeupdate")};
n.pc=function(){if(this.b.error){var a=this.b.error.code;a!=MediaError.MEDIA_ERR_ABORTED&&(a=Error(tb[a]||"Unknown playback error."),a.type="playback",a=y(a),this.dispatchEvent(a))}};n.gc=function(){fa("playing");this.m&&this.m.getEventLogger("playing").setState("playing").log();!this.h&&0>this.l&&(this.b.playbackRate=0,this.A(this.b.currentTime,Date.now(),this.l));this.g&&!this.F&&ib(this)};n.ec=function(){this.m&&this.m.getEventLogger("pause").setState("paused").log();ia("playing");kb(this)};
n.hc=function(a){this.B=a.start};n.oc=function(){return this.c?this.c.R():[]};G.prototype.getVideoTracks=G.prototype.oc;G.prototype.T=function(){return this.c?this.c.Sa():[]};G.prototype.getAudioTracks=G.prototype.T;G.prototype.Z=function(){return this.c?this.c.ab():[]};G.prototype.getTextTracks=G.prototype.Z;G.prototype.selectVideoTrack=function(a,b){return this.c?this.c.selectVideoTrack(a,void 0==b?!0:b):!1};G.prototype.selectVideoTrack=G.prototype.selectVideoTrack;
G.prototype.aa=function(a,b,c){return this.c?ub(this.c,"audio",a,void 0==b?!0:b,c):!1};G.prototype.selectAudioTrack=G.prototype.aa;G.prototype.ba=function(a){return this.c?ub(this.c,"text",a,!1):!1};G.prototype.selectTextTrack=G.prototype.ba;G.prototype.S=function(a){this.c&&vb(this.c,a)};G.prototype.enableTextTrack=G.prototype.S;G.prototype.N=function(a){kb(this);this.o&&this.g||!(0<=a)?this.b.paused||(this.b.playbackRate=0,this.A(this.b.currentTime,Date.now(),a)):this.b.playbackRate=a;this.l=a};
G.prototype.setPlaybackRate=G.prototype.N;G.prototype.J=function(){return this.l};G.prototype.getPlaybackRate=G.prototype.J;G.prototype.ca=function(a){this.C=a};G.prototype.setPlaybackStartTime=G.prototype.ca;G.prototype.H=function(){return this.c?!!this.c.S():!1};G.prototype.isLive=G.prototype.H;
G.prototype.R=function(a){if(a){var b=z(a,"enableAdaptation");null!=b&&(this.a.enableAdaptation=b);b=z(a,"endBufferingOnPlaying");null!=b&&(this.F=b);b=z(a,"usePlaybackRateForBuffering");null!=b&&(this.o=b);b=A(a,"streamBufferSize",0);null!=b&&(this.a.streamBufferSize=b);b=A(a,"dynamicStreamBufferSize",0);null!=b&&(this.a.dynamicStreamBufferSize=b);null!=a.smartBufferAdjustmentParams&&(this.a.smartBufferAdjustmentParams=a.smartBufferAdjustmentParams);b=z(a,"addCdnDebugQueryParameters");null!=b&&(this.a.addCdnDebugQueryParameters=
b);b=A(a,"initialStreamBufferSize",0);null!=b&&(this.a.initialStreamBufferSize=b);b=z(a,"includeStreamBufferSizeInStartOffset");null!=b&&(this.a.includeStreamBufferSizeInStartOffset=b);b=A(a,"jumpToLiveThreshold");null!=b&&(this.a.jumpToLiveThreshold=b);b=A(a,"liveStreamEndTimeout",0);null!=b&&(this.a.liveStreamEndTimeout=b);b=A(a,"licenseRequestTimeout",0);null!=b&&(this.a.licenseRequestTimeout=b);b=A(a,"mpdRequestTimeout",0);null!=b&&(this.a.mpdRequestTimeout=b);b=A(a,"minMpdRefreshInterval",0);
null!=b&&(this.a.minMpdRefreshInterval=b);b=z(a,"enableLiveInterruptionDetection");null!=b&&(this.a.enableLiveInterruptionDetection=b);b=z(a,"enableManifestDebug");null!=b&&(this.a.enableManifestDebug=b,F.prototype.gb=b,b||(F.prototype.ja=function(){}));b=z(a,"resolveVideoTimeUpdateOnFragmentedTimeRanges");null!=b&&(this.a.resolveVideoTimeUpdateOnFragmentedTimeRanges=b);b=A(a,"liveInterruptionConsecutiveUpdatesWithoutChange");null!=b&&(this.a.liveInterruptionConsecutiveUpdatesWithoutChange=b);b=A(a,
"liveInterruptionConsecutiveUpdatesWithChange");null!=b&&(this.a.liveInterruptionConsecutiveUpdatesWithChange=b);b=z(a,"reappendInitSegmentAfterAbort");null!=b&&(this.a.reappendInitSegmentAfterAbort=b);b=z(a,"liveSendPushHeaders");null!=b&&(this.a.liveSendPushHeaders=b);b=A(a,"liveMaxManifestFetchesWithPush");null!=b&&(this.a.liveMaxManifestFetchesWithPush=b);b=A(a,"liveMaxSegmentsToPush");null!=b&&(this.a.liveMaxSegmentsToPush=b);b=A(a,"segmentRequestTimeout",0);null!=b&&(this.a.segmentRequestTimeout=
b);b=Ya(a,"preferredLanguage");null!=b&&(this.a.preferredLanguage=b);b=Za(a,"restrictions",la);null!=b&&(this.a.restrictions=b.clone());b=a.liveInitialPushRepresentation;null!=b&&(this.a.liveInitialPushRepresentation=b);b=a.liveAudioPushRepresentation;null!=b&&(this.a.liveAudioPushRepresentation=b);b=a.useInlineInitSegment;null!=b&&(this.a.useInlineInitSegment=b);b=z(a,"disableCacheBustingEvenThoughItMayAffectBandwidthEstimation");null!=b&&(wb=!b);b=z(a,"currentTimeDuringReadyStateZeroThrows");null!=
b&&(this.a.currentTimeDuringReadyStateZeroThrows=b);b=A(a,"liveDataFetchMaxRetries");null!=b&&(this.a.liveDataFetchMaxRetries=b);b=A(a,"liveSourceBufferClearMaxRetries");null!=b&&(this.a.liveSourceBufferClearMaxRetries=b);b=z(a,"useLongCacheForManifest");null!=b&&(this.a.useLongCacheForManifest=b);b=z(a,"jumpToEarliestPositionInCurrentBlock");null!=b&&(this.a.jumpToEarliestPositionInCurrentBlock=b);b=z(a,"ignoreMinBufferTime");null!=b&&(this.a.ignoreMinBufferTime=b);b=A(a,"playheadFragmentedGapDiffAllowance");
null!=b&&(this.a.playheadFragmentedGapDiffAllowance=b);b=z(a,"fixBufferingGoalDetermination");null!=b&&(this.a.fixBufferingGoalDetermination=b);b=z(a,"skipEmptySegments");null!=b&&(this.a.skipEmptySegments=b);(b=z(a,"useMicroTaskTimeouts"))&&(this.a.useMicroTaskTimeouts=b);(a=z(a,"enableRequestPipelining"))&&(this.a.enableRequestPipelining=a);this.c&&this.c.$a(this.a)}};G.prototype.configure=G.prototype.R;G.prototype.Y=function(){return this.a};G.prototype.getConfiguration=G.prototype.Y;
function kb(a){a.h&&(clearTimeout(a.h),a.h=null)}function rb(a){jb(a);a.w=setTimeout(a.L.bind(a),100)}function jb(a){a.w&&(clearTimeout(a.w),a.w=null)}G.prototype.A=function(a,b,c){this.h=null;var d=(Date.now()-b)/1E3*c;this.b.currentTime<this.B+(this.H()?1:.05)?this.b.pause():(d=Math.max(this.B,a+d),this.b.currentTime=d,this.h=setTimeout(this.A.bind(this,a,b,c),250))};
function ib(a){ia("buffering");a.i&&(a.i.log(),a.i=null);if(a.u){var b=Date.now();a.u.setEvent("buffering").setClientTimeBegin(Math.round(b-ja())).setClientTimeEnd(Math.round(b)).log()}a.o&&(a.b.playbackRate=a.l);a.g=!1;a.dispatchEvent(x({type:"bufferingEnd"}))}
G.prototype.L=function(){rb(this);if(!this.b.ended&&!this.b.seeking){var a=this.b.buffered,b=a.length?a.end(a.length-1):0,a=Math.max(b-this.b.currentTime,0),c=this.b.currentTime,d=this.b.duration,d=isNaN(d)?0:Math.max(d-.05,0),b=b>=d||c>=d;if(!this.g)!this.b.paused&&!b&&.5>a&&(this.g=!0,this.o?this.b.playbackRate=0:this.b.pause(),this.m&&!this.i&&(a=this.b.buffered,a=a.length?a.end(a.length-1):0,a=Math.max(a-this.b.currentTime,0),a=1E3*(xb(this.c)-a),this.i=this.m.getOperationLogger("buffering").setLength(Math.round(a)).start()),
fa("buffering"),this.dispatchEvent(x({type:"bufferingStart"}))),yb(this.c)&&ib(this);else if(a>xb(this.c)||yb(this.c))ib(this),this.G&&!this.o&&this.b.play()}};G.prototype.P=function(a){if(this.c){var b=this.c;b.c.video&&b.c.video.Db(a)}};G.prototype.setVideoStreamOffset=G.prototype.P;var tb={2:"A network failure occured while loading media content.",3:"The browser failed to decode the media content.",4:"The browser does not support the media content."};function I(a){F.call(this,null);this.a=new Na(3);this.h=new Na(10);this.f=a||5E5;this.i=VideoPlayerShakaExperiments.minSampleCount;this.g=0}q(I,F);p("shaka.util.EWMABandwidthEstimator",I);
I.prototype.sample=function(a,b,c,d,e){if(VideoPlayerShakaExperiments.changeAbrAudioExclusionLogic?!c:65536>b)e&&e.setEvent("unsampled").setReason("audio").log();else{if(VideoPlayerShakaExperiments.useResourceTimingEntryForBandwidth){if(!d){e&&e.setEvent("unsampled").setReason("resource_timing_entry_missing").log();return}a=d.timeToLastByte;if(0>a){e&&e.setEvent("unsampled").setReason("resource_timing_entry_invalid").log();return}}a=Math.max(a,50);c=8E3*b/a;var f=a/1E3;this.a.sample(f,c,d);this.h.sample(f,
c,d);this.dispatchEvent(x({type:"bandwidth"}));e&&e.setEvent("sampled").setBytes(b).setDelayMs(parseInt(a,10)).log();this.g=Date.now()}};I.prototype.getBandwidth=function(){return.5<=this.a.a||this.a.c>=this.i?Math.min(Oa(this.a),Oa(this.h)):this.f};I.prototype.getFastMovingBandwidth=function(){return.5>this.a.a?this.f:Oa(this.a)};I.prototype.getDataAge=function(){return(Date.now()-this.g)/1E3};I.prototype.supportsCaching=function(){return!1};I.prototype.setRepresentationID=function(){};
I.prototype.flushABREvaluationSet=function(){return[]};/*

 Copyright 2015 Facebook Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function zb(a,b,c){I.call(this,c);this.c=a||0;this.b=void 0===b?Infinity:b}q(zb,I);p("shaka.util.EWMACacheBandwidthEstimator",zb);zb.prototype.sample=function(a,b,c,d,e){var f=8E3*b/a;e&&e.setBytes(b).setDelayMs(parseInt(a,10));a<=this.c&&f>this.b?e&&e.setEvent("unsampled").setReason("cached").log():I.prototype.sample.call(this,a,b,c,d,e)};zb.prototype.supportsCaching=function(){return Infinity!==this.b&&!!this.c};zb.prototype.setRepresentationID=function(){};zb.prototype.flushABREvaluationSet=function(){return[]};function Ab(){I.call(this)}q(Ab,I);p("shaka.util.EWMASignedURLBandwidthEstimator",Ab);Ab.prototype.supportsCaching=function(){return!0};function J(){var a,b,c=new Promise(function(c,e){a=c;b=e});c.resolve=a;c.reject=b;c.destroy=J.prototype.destroy;return c}J.prototype.destroy=function(){this.catch(function(){});var a=Error("Destroyed!");a.type="destroy";this.reject(a)};function Bb(){this.Fa=new J;this.c=!1;this.fa=null;this.a=[];this.b=null}function Cb(a,b){if(a.c)throw Error("Cannot append to a running task!");a.a.push(b)}Bb.prototype.start=function(){if(this.c)throw Error("Task already started!");this.c=!0;this.a.unshift(function(){});Db(this,void 0)};Bb.prototype.end=function(){this.a.splice(1)};
function Db(a,b){var c=a.a[0](b),d;c?(d=c[0],a.b=c[1]):(d=Promise.resolve(),a.b=null);d.then(H(a,function(a){this.fa?(this.a=[],this.b=null,Eb(this)):(this.a.shift(),this.a.length?Db(this,a):(this.Fa.resolve(a),this.b=null))})).catch(H(a,function(a){this.a=[];this.b=null;this.fa?Eb(this):this.Fa.reject(a)}))}
function Eb(a){function b(){var a=Error("Task aborted.");a.type="aborted";this.Fa.reject(a);setTimeout(function(){this.fa.resolve();this.fa=null}.bind(this),5)}a.f?a.f.then(function(){this.f=null;b.call(this)}.bind(a)):b.call(a)};function H(a,b){return b.bind(a)};function Fb(a,b,c,d,e){MediaSource.isTypeSupported(b);F.call(this,d);d=a.addSourceBuffer(b);this.u=a;this.c=d;this.L=c;this.B=new cb;this.H=this.m=this.R=null;this.G=!1;this.F=this.C=this.D=0;this.A=null;this.P=this.w=!1;this.T=e;this.a=[];this.O=0;this.i=this.b=this.f=null;this.j=this.o=this.N=0;this.J=!1;this.g=b&&b.charAt(0);C(this.B,this.c,"updateend",this.S.bind(this));this.l=null}q(Fb,F);Fb.prototype.ga=function(){return{SourceBuffer:this.c}};
function Gb(a,b,c){a.gb&&a.ja(b,{type:a.g.charAt(0),segment:c,sourceBuffer:a.c})}var Hb=1/60;Fb.prototype.destroy=function(){Ib(this).catch(function(){});this.b&&this.b.destroy();this.a=this.f=this.b=null;this.B.destroy();this.u=this.c=this.B=null};function Jb(a,b){for(var c=a.c.buffered,d=0;d<c.length;++d){var e=c.start(d)-Hb,f=c.end(d)+Hb;if(b>=e&&b<=f)return c.end(d)-b}return 0}
function Kb(a,b,c){b=b.endTime?b.endTime-b.startTime:1;var d=new Lb;d.c=3;d.l=1E3*b;d.g=1E3*a.N;d.u=a.R;d.o=c;d.V=a.T;d.b=a.g;return d}
function Mb(a,b,c,d,e,f,h){var g;a.m&&(g=a.m.getOperationLogger("fetch").setResource(b.url.toString()).setType(Nb(a)).setLength(Math.round(1E3*(b.endTime-b.startTime))).start());a.l=g;if(a.f)return h=Error("Cannot fetch ("+a.g+"): previous operation not complete."),a.o>=a.D?(h.type="stream",g&&g.setError(h).log(),a.o=0):(a.o++,h.type="aborted"),Promise.reject(h);a.f=new Bb;d!=a.c.timestampOffset&&(a.c.timestampOffset=d);d=Kb(a,b,f);var l=Ob(b.url,d,a.L,a.m,a.l,a.H,Nb(a),h);Gb(a,"SegmentFetching",
b);var k=K.prototype.h.bind(b.url);a.A&&a.w&&(e=a.A);var m=0;e&&(a.A=e,a.w=!1,Cb(a.f,function(){return[e.then(function(a){a.va>m&&(m=a.va);return Pb(this,a,null)}.bind(this)),this.h.bind(this)]}.bind(a)));Cb(a.f,H(a,function(){return[l.then(function(a){Gb(this,"SegmentFetched",b);a.va>m&&(m=a.va);da((this.L.getBandwidth()/1E6).toFixed(2));if(this.J){var d;this.m&&(d=this.m.getOperationLogger("cea608_extraction").start());extractCEA608(a,c).then(function(a){d&&d.setLength(a.length).log();a.length&&
this.dispatchEvent(x({type:"cea608-captions",bubbles:!0,detail:{captions:a}}))}.bind(this)).catch(function(a){console.error(a)})}return Pb(this,a,b)}.bind(this)),function(){Gb(this,"SegmentFailed",b);k();return this.h()}.bind(this)]}));var t=0==a.c.buffered.length&&0==a.a.length,v=null;Cb(a.f,function(){if(0==this.c.buffered.length&&!this.P){var a=Error("Failed to buffer segment ("+this.g+").");a.type="stream";return[Promise.reject(a)]}this.c.buffered.length&&t&&(a=b.startTime,v=this.c.buffered.start(0)-
a);a=Qb(this.a,b.startTime);0<=a?this.a.splice(a+1,0,b):this.a.push(b)}.bind(a));a.o=0;return Rb(a).then(function(){g&&g.log();return Promise.resolve({ea:v,Yb:m})}.bind(a),function(a){g&&g.setError(a).log();return Promise.reject(a)})}
function Sb(a){if(a.f){var b=Error("Cannot clear ("+a.g+"): previous operation not complete.");a.j>=a.C?(b.type="stream",a.j=0):(a.j++,b.type="aborted");return Promise.reject(b)}a.f=new Bb;Cb(a.f,function(){var a;a:if(0==this.c.buffered.length)a=Promise.resolve();else{try{this.c.remove(0,this.u.duration)}catch(b){a=Promise.reject(b);break a}this.a=[];a=this.b=new J}return[a,this.h.bind(this)]}.bind(a));a.j=0;return Rb(a)}
function Tb(a,b){if(a.f){var c=Error("Cannot clearAfter ("+a.g+"): previous operation not complete.");c.type="stream";return Promise.reject(c)}a.f=new Bb;Cb(a.f,function(){return[Ub(this,b),this.h.bind(this)]}.bind(a));return Rb(a)}function Vb(a,b){a.b=new J;var c=b-5;if(0<c){try{a.c.remove(0,c)}catch(d){return Promise.reject(d)}c=Qb(a.a,c);0<c&&(a.a=a.a.slice(c,a.a.length))}else a.b.resolve();return a.b}
function Ib(a){a.f?(a=a.f,a.fa?a=a.fa:a.c?(a.b&&(a.f=a.b()),a.fa=new J,a=a.fa):(a.c=!0,a=Promise.resolve())):a=Promise.resolve();return a}function Wb(a){for(var b=a.currentTime,c=b,d=0;d<a.buffered.length;d++)if(b<=a.buffered.start(d)){c=a.buffered.start(d);break}return c}function Xb(a,b){for(var c=b.currentTime,d=0;d<b.buffered.length;d++)if(c>=b.buffered.start(d)&&c<=b.buffered.end(d)-a.F)return!1;return!0}
function Rb(a){a.f.start();return a.f.Fa.then(H(a,function(){this.f=null})).catch(H(a,function(a){this.f=null;return Promise.reject(a)}))}
function Pb(a,b,c){var d;if(a.m){var e=c?c.url.toString():"init";d=a.m.getOperationLogger("append").setResource(e).setType(Nb(a)).setLength(b.byteLength).start();a.l&&(d=d.setParentLogger(a.l))}try{a.c.appendBuffer(b)}catch(f){return d&&d.setError(f).log(),Promise.reject(f)}a.b=new J;a.i=c;return a.b.then(function(){d&&d.log()},function(a){d&&d.setError(a).log();return Promise.reject(a)})}
function Ub(a,b){if(0==a.c.buffered.length)return Promise.resolve();var c=Qb(a.a,b);if(-1==c||c==a.a.length-1)return Promise.resolve();try{a.c.remove(a.a[c+1].startTime,a.u.duration)}catch(d){return Promise.reject(d)}a.a=a.a.slice(0,c+1);a.b=new J;return a.b}Fb.prototype.h=function(){if(this.b){if("open"==this.u.readyState){var a=Error("Previous operation aborted.");a.type="aborted";this.b.reject(a);this.c.abort();this.G&&(this.w=!0);this.b=new J}return this.b}return Promise.resolve()};
Fb.prototype.S=function(){this.b&&(this.i&&(Gb(this,"SegmentAppended",this.i),this.i=null),this.b.resolve(),this.b=null)};function Nb(a){return"v"===a.g.charAt(0)?"video":"a"===a.g.charAt(0)?"audio":null};function Yb(a){return String.fromCharCode.apply(null,a)}p("shaka.util.Uint8ArrayUtils.toString",Yb);function Zb(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}p("shaka.util.Uint8ArrayUtils.fromString",Zb);p("shaka.util.Uint8ArrayUtils.toBase64",function(a,b){var c=void 0==b?!0:b,d=window.btoa(Yb(a)).replace(/\+/g,"-").replace(/\//g,"_");return c?d:d.replace(/=*$/,"")});function $b(a){return Zb(window.atob(a.replace(/-/g,"+").replace(/_/g,"/")))}
p("shaka.util.Uint8ArrayUtils.fromBase64",$b);p("shaka.util.Uint8ArrayUtils.fromHex",function(a){for(var b=new Uint8Array(a.length/2),c=0;c<a.length;c+=2)b[c/2]=window.parseInt(a.substr(c,2),16);return b});function ac(a){for(var b="",c=0;c<a.length;++c){var d=a[c].toString(16);1==d.length&&(d="0"+d);b+=d}return b}p("shaka.util.Uint8ArrayUtils.toHex",ac);function Ka(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0};function bc(){this.g=this.b="";this.l=!1;this.u=this.o=null;this.h=this.f=!1;this.j=this.c="";this.i=null;this.a=[]}function cc(a,b){var c=a.a.concat(b.map(function(a){return{initData:new Uint8Array(a.initData.buffer),initDataType:a.initDataType}}));a.a=wa(c)}function xa(a,b){return a.initDataType==b.initDataType&&Ka(a.initData,b.initData)};function ec(a,b,c,d){this.a=[];d&&this.a.push(d)}p("shaka.player.DrmSchemeInfo",ec);ec.DistinctiveIdentifier={OPTIONAL:0,REQUIRED:1};ec.PersistentState={OPTIONAL:0,REQUIRED:1};ec.createUnencrypted=function(){return new ec(0,0,0,null)};function fc(a){this.systemIds=[];this.cencKeyIds=[];this.a=[];a=new Aa(new DataView(a.buffer));try{for(;Ca(a);){var b=a.a,c=r(a),d=r(a);1==c?c=Fa(a):0==c&&(c=a.b.byteLength-b);if(1886614376!=d)u(a,c-(a.a-b));else{var e=Da(a);if(1<e)u(a,c-(a.a-b));else{u(a,3);var f=ac(Ga(a)),h=[];if(0<e)for(var g=r(a),l=0;l<g;++l){var k=ac(Ga(a));h.push(k)}var m=r(a);u(a,m);this.cencKeyIds.push.apply(this.cencKeyIds,h);this.systemIds.push(f);this.a.push({start:b,end:a.a-1});a.a!=b+c&&u(a,c-(a.a-b))}}}}catch(t){}};var gc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function L(a){var b;a instanceof L?(hc(this,a.da),this.na=a.na,this.W=a.W,ic(this,a.ua),this.X=a.X,jc(this,a.a.clone()),this.ka=a.ka):a&&(b=String(a).match(gc))?(hc(this,b[1]||"",!0),this.na=kc(b[2]||""),this.W=kc(b[3]||"",!0),ic(this,b[4]),this.X=kc(b[5]||"",!0),jc(this,b[6]||"",!0),this.ka=kc(b[7]||"")):this.a=new lc(null)}n=L.prototype;n.da="";n.na="";n.W="";n.ua=null;n.X="";n.ka="";
n.toString=function(){var a=[],b=this.da;b&&a.push(mc(b,nc,!0),":");if(b=this.W){a.push("//");var c=this.na;c&&a.push(mc(c,nc,!0),"@");a.push(encodeURIComponent(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));b=this.ua;null!=b&&a.push(":",String(b))}if(b=this.X)this.W&&"/"!=b.charAt(0)&&a.push("/"),a.push(mc(b,"/"==b.charAt(0)?oc:pc,!0));(b=this.a.toString())&&a.push("?",b);(b=this.ka)&&a.push("#",mc(b,qc));return a.join("")};
n.resolve=function(a){var b=this.clone();"data"===b.da&&(b=new L);var c=!!a.da;c?hc(b,a.da):c=!!a.na;c?b.na=a.na:c=!!a.W;c?b.W=a.W:c=null!=a.ua;var d=a.X;if(c)ic(b,a.ua);else if(c=!!a.X){if("/"!=d.charAt(0))if(this.W&&!this.X)d="/"+d;else{var e=b.X.lastIndexOf("/");-1!=e&&(d=b.X.substr(0,e+1)+d)}if(".."==d||"."==d)d="";else if(-1!=d.indexOf("./")||-1!=d.indexOf("/.")){for(var e=0==d.lastIndexOf("/",0),d=d.split("/"),f=[],h=0;h<d.length;){var g=d[h++];"."==g?e&&h==d.length&&f.push(""):".."==g?((1<
f.length||1==f.length&&""!=f[0])&&f.pop(),e&&h==d.length&&f.push("")):(f.push(g),e=!0)}d=f.join("/")}}c?b.X=d:c=""!==a.a.toString();c?jc(b,a.a.clone()):c=!!a.ka;c&&(b.ka=a.ka);return b};n.clone=function(){return new L(this)};function hc(a,b,c){a.da=c?kc(b,!0):b;a.da&&(a.da=a.da.replace(/:$/,""))}function ic(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.ua=b}else a.ua=null}function jc(a,b,c){b instanceof lc?a.a=b:(c||(b=mc(b,rc)),a.a=new lc(b))}
function kc(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""}function mc(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,sc),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function sc(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var nc=/[#\/\?@]/g,pc=/[\#\?:]/g,oc=/[\#\?]/g,rc=/[\#\?@]/g,qc=/#/g;function lc(a){this.b=a||null}lc.prototype.a=null;lc.prototype.c=null;
function M(a,b,c){if(!a.a&&(a.a={},a.c=0,a.b))for(var d=a.b.split("&"),e=0;e<d.length;e++){var f=d[e].indexOf("="),h=null,g=null;0<=f?(h=d[e].substring(0,f),g=d[e].substring(f+1)):h=d[e];h=decodeURIComponent(h.replace(/\+/g," "));g=g||"";M(a,h,decodeURIComponent(g.replace(/\+/g," ")))}a.b=null;(d=a.a.hasOwnProperty(b)&&a.a[b])||(a.a[b]=d=[]);d.push(c);a.c++}
lc.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var a=[],b;for(b in this.a)for(var c=encodeURIComponent(b),d=this.a[b],e=0;e<d.length;e++){var f=c;""!==d[e]&&(f+="="+encodeURIComponent(d[e]));a.push(f)}return this.b=a.join("&")};lc.prototype.clone=function(){var a=new lc;a.b=this.b;if(this.a){var b={},c;for(c in this.a)b[c]=this.a[c].concat();a.a=b;a.c=this.c}return a};function uc(a,b,c){var d=a.indexOf("<?xml");0<=d&&(a=a.substr(d));a=(new DOMParser).parseFromString(a,"text/xml");if(!a)return null;"string"===typeof b&&(b=[new L(b)]);b=b||[new L("")];c=c||[new L("")];return N({vb:b,baseUrl:c},a,vc)}p("shaka.dash.mpd.parseMpd",uc);function vc(){this.id=this.url=null;this.type="static";this.b=this.j=this.baseUrl=this.vb=null;this.h=5;this.f=this.c=this.g=null;this.i=1;this.a=[]}
function wc(){this.f=this.c=this.b=this.baseUrl=this.duration=this.start=this.id=null;this.a=[]}function xc(){this.f=this.l=this.b=this.height=this.width=this.contentType=this.lang=this.group=this.id=null;this.g=!1;this.j=this.i=this.h=this.baseUrl=null;this.o=[];this.a=[];this.c=null}function yc(){this.value=null}function zc(){this.lang=this.a=null}function Ac(){this.contentType=this.lang=this.id=null}
function Bc(){this.a=this.b=this.g=this.h=this.baseUrl=this.j=this.fbQualityClass=this.fbQualityLabel=this.i=this.f=this.height=this.width=this.bandwidth=this.lang=this.id=null;this.c=[]}function Cc(){this.value=this.a=null}Cc.prototype.clone=function(){var a=new Cc;a.a=this.a;a.value=this.value;return a};Cc.prototype.parse=function(a,b){this.a=O(b,"schemeIdUri",P,this.a);this.value=O(b,"value",P,this.value)};function Dc(){this.b=this.a=this.f=this.c=null}
function Ec(){this.parsedPssh=this.psshBox=null}function Fc(){this.url=null}function Gc(){this.url=null}function Hc(){this.baseUrl=null;this.b=1;this.f=this.c=this.g=this.a=this.h=null}Hc.prototype.clone=function(){var a=new Hc;a.baseUrl=Ic(this.baseUrl);a.b=this.b;a.h=this.h;a.a=Q(this.a);a.g=Q(this.g);a.c=Q(this.c);a.f=Q(this.f);return a};function Jc(){this.a=this.url=null}Jc.prototype.clone=function(){var a=new Jc;a.url=Ic(this.url);a.a=Q(this.a);return a};function Kc(){this.a=this.url=null}
Kc.prototype.clone=function(){var a=new Kc;a.url=Ic(this.url);a.a=Q(this.a);return a};function Lc(){this.baseUrl=null;this.b=1;this.c=this.g=null;this.i=0;this.h=null;this.a=[];this.f=null}Lc.prototype.clone=function(){var a=new Lc;a.baseUrl=Ic(this.baseUrl);a.b=this.b;a.g=this.g;a.c=this.c;a.i=this.i;a.h=Q(this.h);a.a=Ic(this.a)||[];a.f=Q(this.f);return a};function Mc(){this.a=this.b=null}Mc.prototype.clone=function(){var a=new Mc;a.b=Ic(this.b);a.a=Q(this.a);return a};
function Nc(){this.b=1;this.a=this.i=null;this.j=0;this.c=this.g=this.f=this.h=null}Nc.prototype.clone=function(){var a=new Nc;a.b=this.b;a.i=this.i;a.a=this.a;a.j=this.j;a.h=this.h;a.f=this.f;a.g=this.g;a.c=Q(this.c);return a};function Oc(){this.a=[]}Oc.prototype.clone=function(){var a=new Oc;a.a=Ic(this.a)||[];return a};function Pc(){this.a=this.duration=this.startTime=null}Pc.prototype.clone=function(){var a=new Pc;a.startTime=this.startTime;a.duration=this.duration;a.a=this.a;return a};
function Qc(a,b){this.sa=a;this.end=b}Qc.prototype.clone=function(){return new Qc(this.sa,this.end)};vc.TAG_NAME="MPD";wc.TAG_NAME="Period";xc.TAG_NAME="AdaptationSet";yc.TAG_NAME="Role";zc.TAG_NAME="Accessibility";Ac.TAG_NAME="ContentComponent";Bc.TAG_NAME="Representation";Dc.TAG_NAME="ContentProtection";Ec.TAG_NAME="cenc:pssh";Fc.TAG_NAME="BaseURL";Cc.TAG_NAME="AudioChannelConfiguration";Gc.TAG_NAME="Location";Hc.TAG_NAME="SegmentBase";Jc.TAG_NAME="RepresentationIndex";Kc.TAG_NAME="Initialization";
Lc.TAG_NAME="SegmentList";Mc.TAG_NAME="SegmentURL";Nc.TAG_NAME="SegmentTemplate";Oc.TAG_NAME="SegmentTimeline";Pc.TAG_NAME="S";
vc.prototype.parse=function(a,b){this.url=a.vb;this.id=O(b,"id",P);this.type=O(b,"type",P)||"static";this.b=O(b,"mediaPresentationDuration",Rc);this.h=O(b,"minBufferTime",Rc,this.h);this.g=O(b,"minimumUpdatePeriod",Rc,this.g);this.c=O(b,"availabilityStartTime",Sc,this.c);this.f=O(b,"timeShiftBufferDepth",Rc,this.f);this.f=null;this.i=O(b,"suggestedPresentationDelay",Rc,this.i);var c=a.baseUrl,d=R(this,b,Fc);this.baseUrl=Tc(c,d);if(d=N(this,b,Gc))this.j=Uc(c,d.url);this.a=R(this,b,wc)};
function Vc(a,b,c,d){if(0!==a.a.length){var e=new xc;e.contentType="text";e.lang=c||"en";e.g=!0;c=new Bc;c.bandwidth=0;c.f=d||"text/vtt";c.baseUrl=[new L(b)];e.a.push(c);a.a[0].a.push(e);Wc(a.a[0])}}wc.prototype.parse=function(a,b){this.id=O(b,"id",P);this.start=O(b,"start",Rc);this.duration=O(b,"duration",Rc);var c=R(this,b,Fc);this.baseUrl=Tc(a.baseUrl,c);this.b=N(this,b,Hc);this.c=N(this,b,Lc);this.f=N(this,b,Nc);this.a=R(this,b,xc);Wc(this)};
function Wc(a){for(var b=[],c=0;c<a.a.length;++c){var d=a.a[c];null!=d.group&&(b[d.group]=!0)}for(c=0;c<a.a.length;++c)if(d=a.a[c],null==d.group){for(var e=1;1==b[e];)++e;b[e]=!0;d.group=e}}
xc.prototype.parse=function(a,b){var c=N(this,b,Ac)||{},d=N(this,b,yc);this.id=O(b,"id",P);this.group=O(b,"group",S);this.lang=O(b,"lang",P,c.lang);this.contentType=O(b,"contentType",P,c.contentType);this.width=O(b,"width",T);this.height=O(b,"height",T);this.b=O(b,"mimeType",P);this.l=O(b,"codecs",P);this.f=O(b,"FBProjection",P);this.g=d&&"main"==d.value;this.lang&&(this.lang=Ra(this.lang));c=R(this,b,Fc);this.baseUrl=Tc(a.baseUrl,c);this.o=R(this,b,Dc);!this.contentType&&this.b&&(this.contentType=
this.b.split("/")[0]);this.h=a.b?Xc(this,b,a.b):N(this,b,Hc);this.i=a.c?Xc(this,b,a.c):N(this,b,Lc);this.j=a.f?Xc(this,b,a.f):N(this,b,Nc);this.a=R(this,b,Bc);this.c=N(this,b,zc);!this.b&&this.a.length&&(this.b=this.a[0].f,!this.contentType&&this.b&&(this.contentType=this.b.split("/")[0]))};yc.prototype.parse=function(a,b){this.value=O(b,"value",P)};zc.prototype.parse=function(a,b){this.a=O(b,"schemeIdUri",P);this.lang=O(b,"lang",P)};
Ac.prototype.parse=function(a,b){this.id=O(b,"id",P);this.lang=O(b,"lang",P);this.contentType=O(b,"contentType",P);this.lang&&(this.lang=Ra(this.lang))};
Bc.prototype.parse=function(a,b){this.id=O(b,"id",P);this.bandwidth=O(b,"bandwidth",T);this.width=O(b,"width",T,a.width);this.height=O(b,"height",T,a.height);this.f=O(b,"mimeType",P,a.b);this.i=O(b,"codecs",P,a.l);this.fbQualityLabel=O(b,"FBQualityLabel",P);this.fbQualityClass=O(b,"FBQualityClass",P);this.j=O(b,"FBAbrPolicyTags",P);this.lang=a.lang;var c=R(this,b,Fc);this.baseUrl=Tc(a.baseUrl,c);this.c=R(this,b,Dc);this.h=N(this,b,Cc);this.g=a.h?Xc(this,b,a.h):N(this,b,Hc);this.b=a.i?Xc(this,b,a.i):
N(this,b,Lc);this.a=a.j?Xc(this,b,a.j):N(this,b,Nc);this.c=this.c.concat(a.o)};Dc.prototype.parse=function(a,b){this.c=b;this.f=O(b,"schemeIdUri",P);var c=O(b,"cenc:default_KID",P);c&&(this.b=c.replace(/[-]/g,""));this.a=N(this,b,Ec)};Ec.prototype.parse=function(a,b){var c=Yc(b);if(c){this.psshBox=$b(c);try{this.parsedPssh=new fc(this.psshBox)}catch(d){if(!(d instanceof RangeError))throw d;}}};
Fc.prototype.parse=function(a,b){var c=b.childNodes,d="";if(1==c.length)d=Yc(b);else for(var e=0;e<c.length;e++)c[e].nodeType==Node.TEXT_NODE&&(d+=c[e].nodeValue);this.url=d};Gc.prototype.parse=function(a,b){this.url=Yc(b)};
Hc.prototype.parse=function(a,b){this.baseUrl=a.baseUrl||this.baseUrl;this.b=O(b,"timescale",T,this.b);this.h=O(b,"presentationTimeOffset",S,this.h);this.a=O(b,"indexRange",Zc,this.a);this.g=O(b,"FBFirstSegmentRange",Zc,this.g);this.c=N(this,b,Jc)||this.c;this.f=N(this,b,Kc)||this.f};Jc.prototype.parse=function(a,b){var c=O(b,"sourceURL",P);this.url=Uc(a.baseUrl,c);this.a=O(b,"range",Zc,Q(a.a))};
Kc.prototype.parse=function(a,b){var c=O(b,"sourceURL",P);this.url=Uc(a.baseUrl,c);this.a=O(b,"range",Zc)};Lc.prototype.parse=function(a,b){this.baseUrl=a.baseUrl||this.baseUrl;this.b=O(b,"timescale",T,this.b);this.g=O(b,"presentationTimeOffset",S,this.g);this.c=O(b,"duration",T,this.c);var c=O(b,"startNumber",T);null!=c&&(this.i=c);this.h=N(this,b,Kc)||this.h;this.a=(c=R(this,b,Mc))&&0<c.length?c:this.a;this.f=N(this,b,Oc)||this.f};
Mc.prototype.parse=function(a,b){var c=O(b,"media",P);this.b=Uc(a.baseUrl,c);this.a=O(b,"mediaRange",Zc)};Nc.prototype.parse=function(a,b){this.b=O(b,"timescale",T,this.b);this.i=O(b,"presentationTimeOffset",S,this.i);this.a=O(b,"duration",T,this.a);var c=O(b,"startNumber",S);null!=c&&(this.j=c);this.h=O(b,"media",P,this.h);this.f=O(b,"index",P,this.f);this.g=O(b,"initialization",P,this.g);this.c=N(this,b,Oc)||this.c};Oc.prototype.parse=function(a,b){this.a=R(this,b,Pc)};
Pc.prototype.parse=function(a,b){this.startTime=O(b,"t",S);this.duration=O(b,"d",S);this.a=O(b,"r",$c)};function Tc(a,b){if(!b||0===b.length)return a;for(var c=[],d=0;d<b.length;d++){var e=b[d].url;null==a||0===a.length?c.push(new L(e)):(e=Uc(a.slice(0,1),e),c.push(e[0]))}return c}function Uc(a,b){if(!b)return a;var c=new L(b);return a?a.map(function(a){return a.resolve(c)}):[c]}function Xc(a,b,c){var d=Q(c);(b=ad(b,c.constructor.TAG_NAME))&&d.parse(a,b);return d}
function N(a,b,c){var d=null;if(b=ad(b,c.TAG_NAME))d=new c,d.parse(a,b);return d}function ad(a,b){for(var c=null,d=0;d<a.childNodes.length;d++)if(a.childNodes[d].tagName==b){if(c)return null;c=a.childNodes[d]}return c}function R(a,b,c){for(var d=[],e=0;e<b.childNodes.length;e++)if(b.childNodes[e].tagName==c.TAG_NAME){var f=new c;f.parse.call(f,a,b.childNodes[e]);d.push(f)}return d}function Yc(a){a=a.firstChild;return a.nodeType!=Node.TEXT_NODE?null:a.nodeValue}
function Ic(a){return a?a.map(function(a){return a.clone()}):null}function Q(a){return a?a.clone():null}function O(a,b,c,d){a=c(a.getAttribute(b));return null!=a?a:void 0!==d?d:null}function Sc(a){if(!a)return null;a=Date.parse(a);return isNaN(a)?null:Math.floor(a/1E3)}
function Rc(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);if(!b)return null;a=0;var c=S(b[1]);c&&(a+=31536E3*c);(c=S(b[2]))&&(a+=2592E3*c);(c=S(b[3]))&&(a+=86400*c);(c=S(b[4]))&&(a+=3600*c);(c=S(b[5]))&&(a+=60*c);b=window.parseFloat(b[6]);(b=isNaN(b)?null:b)&&(a+=b);return a}
function Zc(a){var b=/([0-9]+)-([0-9]+)/.exec(a);if(!b)return null;a=S(b[1]);if(null==a)return null;b=S(b[2]);return null==b?null:new Qc(a,b)}function $c(a){a=window.parseInt(a,10);return isNaN(a)?null:a}function T(a){a=window.parseInt(a,10);return 0<a?a:null}function S(a){a=window.parseInt(a,10);return 0<=a?a:null}function P(a){return a};function bd(a,b){this.url=a;this.b=b||new Lb;this.j=0;this.g=-1;this.h=this.i=0;this.a=null;this.c=new J;this.f=null;this.A=this.b.j}p("shaka.util.AjaxRequest",bd);function Lb(){this.body=null;this.c=1;this.l=1E3;this.g=0;this.method="GET";this.h="arraybuffer";this.f={};this.i=!1;this.V=this.a=this.u=null;this.o=!1;this.j=this.b=null}var wb=!0;function cd(a){dd(a);ed(a);a.b.body=null;a.c.destroy();a.c=null;a.f=null}
function ed(a){a.a&&(a.a.onload=null,a.a.onreadystatechange=null,a.a.onerror=null,a.a.ontimeout=null);a.a=null}function dd(a){-1!==a.g&&(clearTimeout(a.g),a.g=-1)}var fd=/(.*)\.(xx|fna)\.fbcdn\.net/,gd=/livestream-lookaside\.facebook\.com$/;
bd.prototype.l=function(){if(this.a)return this.c;if(0==this.url.lastIndexOf("data:",0)){var a=this.url.split(":")[1].split(";").pop().split(","),b=a.pop(),b="base64"==a.pop()?window.atob(b.replace(/-/g,"+").replace(/_/g,"/")):window.decodeURIComponent(b);"arraybuffer"==this.b.h&&(b=Zb(b).buffer);a=JSON.parse(JSON.stringify(new XMLHttpRequest));a.response=b;a.responseText=b.toString();b=this.c;b.resolve(a);cd(this);return b}if(0==this.url.lastIndexOf("idb:",0))return this.C();this.j++;this.i=performanceNow();
this.h||(this.h=this.b.l);this.a=new XMLHttpRequest;var c=this.url,a=new L(c);wb&&(this.f&&!this.f.supportsCaching()||this.b.i)&&M(a.a,"_",Date.now());c=fd.test(c);if(null!=this.b.a&&c){var d=this.b.a,e=a.a;null!=d.a&&(d.h=d.a.getSegmentsToPush(),d.f=d.a.getSegmentStartTime(),d.g=d.a.getSegmentOffset(),d.c=d.a.getPushVideoRepresentationID(),d.b=d.a.getPushAudioRepresentationID(),d.j=d.a.getUseLongCacheForManifest());null!=d.h&&M(e,"_nc_p_n",d.h);null!=d.f?M(e,"_nc_p_ts",d.f):null!=d.g&&M(e,"_nc_p_o",
d.g);null!=d.c&&null!=d.b&&(M(e,"_nc_p_rid",d.c),M(e,"_nc_p_arid",d.b));d.i&&M(e,"_nc_p_dbg","1");d.j&&M(e,"_nc_nc","1")}1==this.b.o&&c&&M(a.a,"_nc_playing",1);c=a.toString();a=gd.test(a.W);this.a.open(this.b.method,c,!0);this.a.responseType=this.b.h;this.a.timeout=this.b.g;this.a.withCredentials=a;setEventProperty(this.a,"onload",this.o.bind(this));setEventProperty(this.a,"onreadystatechange",this.u.bind(this));setEventProperty(this.a,"onerror",this.B.bind(this));setEventProperty(this.a,"ontimeout",
this.w.bind(this));for(b in this.b.f)this.a.setRequestHeader(b,this.b.f[b]);this.a.send(this.b.body);return this.c};bd.prototype.send=bd.prototype.l;function hd(a,b,c){b=Error(b);b.type=c;b.status=a.a.status;b.url=a.url;b.method=a.b.method;b.body=a.b.body;b.sc=a.a;return b}
bd.prototype.o=function(a){if(this.f){var b=VideoPlayerResourceTimer.getResourceTimingEntry(this.url,this.i,performanceNow());this.f.sample(performanceNow()-this.i,a.loaded||this.a.response&&this.a.response.byteLength||0,this.b.b?"v"===this.b.b.charAt(0):!1,b,this.A)}a=[403];200<=this.a.status&&299>=this.a.status?(this.c.resolve(this.a),cd(this)):this.j<this.b.c&&-1===a.indexOf(this.a.status)?id(this):(a=hd(this,"HTTP error.","net"),this.c.reject(a),cd(this))};
bd.prototype.u=function(){if(this.a.readyState==XMLHttpRequest.HEADERS_RECEIVED&&(this.a.va=Date.now()-this.i,this.b.a&&this.b.V&&jd(this.b.V,this.a),this.b.i)){var a=Date.parse(this.a.getResponseHeader("Date"));a&&(za=a-Date.now())}};bd.prototype.B=function(){if(VideoPlayerShakaExperiments.allowInfiniteRetryOnNetErr)id(this);else{var a=hd(this,"Network failure.","net");this.c.reject(a);cd(this)}};
bd.prototype.w=function(){if(this.j<this.b.c)id(this);else{var a=hd(this,"Request timed out.","net");this.c.reject(a);cd(this)}};function id(a){ed(a);a.g=setTimeout(function(){this.g=-1;this.l()}.bind(a),a.h*(1+.5*(2*Math.random()-1)));a.h*=2}function kd(){this.a=new Map;this.b=!1}
function jd(a,b){var c=b.getResponseHeader("X-FB-Debug-Num-Pushed"),d=b.getResponseHeader("X-FB-Debug-List-Pushed");null!=d&&null!=c&&(c=parseInt(c,10),d=d.split(","),c!=d.length&&console.warn("Inconsistent push debug headers.",c,d),c&&(-1<d[0].indexOf("/")&&(a.b=!0),d.forEach(function(a){this.a.set(a,(this.a.get(a)||0)+1)}.bind(a))))}var ld=/\/([^\/]+)$/,md=/\/([^\/]+\/[^\/]+)$/;function nd(a,b){var c;c=(new L(b)).X;c=(a.b?md:ld).exec(c);if(!c)return 0;c=c[1];return a.a.get(c)||0};function K(a,b,c,d){this.c=b;this.startByte=c||0;this.baseUrl=this.toString();this.endByte=null!=d?d:null;this.g=this.f=null;this.j=a;this.i=null;this.l=!1;this.b=this.a=null}var od;p("shaka.util.FailoverUri",K);K.prototype.u=function(){return this.startByte};K.prototype.getStartByte=K.prototype.u;K.prototype.o=function(){return this.endByte};K.prototype.getEndByte=K.prototype.o;function pd(a,b){return a&&0!==a.length?a.map(function(a){return a.resolve(b)}):[b]}
K.setPrefetchCacheValueGetter=function(a){od=a};function Ob(a,b,c,d,e,f,h,g){if(a.f)return a.f;a.f=qd(a,0,b||new Lb,c,d,e,f,h,g);return a.f}
function qd(a,b,c,d,e,f,h,g,l){return rd(a,b,c,d,e,f,h,g,l).then(function(a){function b(){return a.read().then(function(a){var d=a.value;if(a.done)return c||new ArrayBuffer(0);if(d){if("string"===typeof d)d=(c||"")+d;else{a=c||new ArrayBuffer(0);var e=new Uint8Array(a.byteLength+d.byteLength);e.set(new Uint8Array(a),0);e.set(new Uint8Array(d),a.byteLength);d=e.buffer}c=d}return b()}.bind(this))}var c;return b()}.bind(a))}
K.prototype.h=function(){if(this.g){this.a=this.f=null;var a=this.g;dd(a);if(a.a&&a.a.readyState!=XMLHttpRequest.DONE){a.a.abort();var b=hd(a,"Request aborted.","aborted");a.c.reject(b);cd(a)}this.i=this.g=null}this.b&&(this.b.abortRequest(sd(this)),VideoPlayerShakaExperiments.fixingSchedulerDisableLeaks&&(this.b=null))};
function rd(a,b,c,d,e,f,h,g,l){var k=a.c[b].toString();a.b=l||null;var m;e&&(c.a&&(c.a.i=!0),l=0,c.V&&(l=nd(c.V,k)),m=e.getOperationLogger("request").setPushed(l).setType(g||null).setInitiator("shaka").start(),f&&(m=m.setParentLogger(f)));var t=performanceNow();a.a=null;h&&(c.j=h);if(a.startByte||a.endByte)g=a.c[b].W,!g.endsWith("fbcdn.net")||g.startsWith("interncache")||g.endsWith("ak.fbcdn.net")?c.f.Range="bytes="+(a.startByte+"-"+(null!=a.endByte?a.endByte:"")):(k+="&bytestart="+a.startByte,k+=
null!==a.endByte?"&byteend="+a.endByte:"");a.j&&(k=a.j(k,c.f)||k);g=null;a.l=!1;od&&(l=od(k,H(a,function(a){this.a=a;this.l=!0;m&&m.setInitiator("prefetch");d&&a&&d.sample(a.timeToLastByte,a.transferSize,c.b?"v"===c.b.charAt(0):!1,a,h)})))&&(g=l);l=null;if(a.b&&!a.b.isDisabled()&&!g)try{(g=l=a.b.getPromise(sd(a)))?m=null:a.b.disable()}catch(v){e&&e.getEventLogger("request_info_not_found").setResource(k).log()}g||(a.g=new bd(k,c),d&&(a.g.f=d),g=a.g.l());m&&m.setResource(k);f&&f.setResource(k);var D=
!1,E=g.then(H(a,function(a){!this.b||this.b.isDisabled()||this.a?this.a||(this.a=VideoPlayerResourceTimer.getResourceTimingEntry(k,t,performanceNow())):this.a=this.b.getResourceTimingEntry(k);this.b=this.i=this.g=this.f=null;this.i=a.a?new L(a.a):this.c[b];a.response.va=a.va;m&&(m=m.setLength(a.response.byteLength||a.response.length).setWasPrefetchCacheHit(this.l),null!=this.a&&(m=m.setTimeToLastByte(Math.round(this.a.timeToLastByte)).setTimeToFirstByte(Math.round(this.a.timeToFirstByte)).setTimeToRequestStart(Math.round(this.a.timeToRequestStart)),
2E3<=this.a.timeToFirstByte&&-1<k.indexOf("akamaihd")&&logLongAkamaiRequest(a.getResponseHeader("Debug-Info")+", TTFB-> "+this.a.timeToFirstByte+", TTRS-> "+this.a.timeToRequestStart)),m.log());return Promise.resolve({value:a.response,done:!1})})),E=E.catch(H(a,function(a){if(this.f&&b+1<this.c.length)return this.f=qd(this,b+1,c,d);this.b=this.a=this.f=this.g=null;m&&m.setError(a).log();return Promise.reject(a)}));return Promise.resolve({read:function(){return D?Promise.resolve({value:null,done:!0}):
E.then(function(a){D=!0;return a})}.bind(a)})}function sd(a){return{baseUrl:a.toString(),startByte:a.startByte,endByte:a.endByte}}K.prototype.clone=function(){return new K(this.j,this.c.map(function(a){return a.clone()}),this.startByte,this.endByte)};K.prototype.getResourceTimingEntry=function(){return this.a};K.prototype.toString=function(){return this.c[0].toString()};function td(a,b,c,d){this.a=new Lb;this.a.h="text";this.a.c=3;this.a.g=1E3*(null!=b?b:0);c&&(this.a.a=c);d&&(this.a.V=d);this.a.i=!0;this.b=a}function ud(a,b){var c=a.b;return Ob(c,a.a,null,b,null,null,"manifest").then(function(a){a instanceof ArrayBuffer&&(a=String.fromCharCode.apply(null,new Uint8Array(a)));if(a=uc(a,c.c,[c.i]))return Promise.resolve(a);a=Error("MPD parse failure.");a.type="dash";return Promise.reject(a)})}
function vd(a){this.a=null;this.h=a;this.c=this.g=this.f=null;this.i=!1;this.j=this.b=null};function wd(a,b,c,d){for(var e=b.a,f=[],h=0;h<d;++h){var g=h+c,l=(g-1)*e.a,k=l/e.b,m=(l+e.a)/e.b,g=xd(a,b,e.j+g-1,l);if(!g)return null;f.push(new yd(k,m,g,l))}return f}function xd(a,b,c,d){if(!b.a)return null;var e=b.a.h;if(!e)return b.baseUrl?new K(a,b.baseUrl,0,null):null;c=zd(e,b.id,c,b.bandwidth,d);if(!c)return null;b=pd(b.baseUrl,c);return new K(a,b,0,null)}
function zd(a,b,c,d,e){var f={RepresentationID:b,Number:c,Bandwidth:d,Time:e};a=a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(a,b,c){if("$$"==a)return"$";var d=f[b];if(null==d)return a;"RepresentationID"==b&&c&&(c=void 0);a=d.toString();c=window.parseInt(c,10)||1;c=Math.max(0,c-a.length);return Array(c+1).join("0")+a});try{return new L(a)}catch(h){if(h instanceof URIError)return null;throw h;}}
function Ad(a,b,c){var d=0;c*=b;a=a.a;for(var e=[],f=0;f<a.length&&a[f].duration;++f){var h=a[f].startTime,h=null!=h?h:d,g=a[f].a||0;if(0>g)if(g=a[f].duration,f+1===a.length)var l=a[0].startTime+c-h,g=Math.ceil(l/g)-1;else g=Math.ceil((a[f+1].startTime-h)/g)-1;if(0<e.length&&h!=d){var l=h-d,k=e[e.length-1];k.debugInfo={endTime:d/b,delta:l/b};k.end=h}for(l=0;l<=g;++l)d=h+a[f].duration,e.push({start:h,end:d}),h=d}return e};function Bd(a,b){this.a=a;this.b=b||null}Bd.prototype.destroy=function(){this.a&&(this.a.h(),this.a=null);this.b=null};Bd.prototype.create=function(a,b){var c=null;b&&(c=new Lb,c.V=b);return this.a?Ob(this.a,c,null,a,null,null,"init"):Promise.resolve(this.b)};Bd.prototype.c=function(){return this.a};Bd.prototype.getFailoverUri=Bd.prototype.c;function yd(a,b,c,d,e){this.startTime=a;this.endTime=b;this.url=c;this.a=null!=d?d:null;this.debugInfo=e||null}function Ld(a,b,c){return new yd(b,c,a.url,null!=a.a?a.a:void 0)}function Qb(a,b){for(var c=a.length-1;0<=c;--c){var d=a[c];if(b>=d.startTime&&(null==d.endTime||b<d.endTime))return c}return-1}function Md(a,b){return a.map(function(a){return Ld(a,a.startTime+b,null!=a.endTime?a.endTime+b:null)})};function Nd(){}
Nd.prototype.parse=function(a,b,c,d,e){var f=null;try{a:{var h=[],g=new Aa(a),l=r(g);if(1936286840!=r(g))f=null;else{1==l&&(l=Fa(g));var k=Da(g);u(g,3);u(g,4);var m=r(g);if(0==m)f=null;else{var t,v;0==k?(t=r(g),v=r(g)):(t=Fa(g),v=Fa(g));u(g,2);var D=g.b.getUint16(g.a,g.c);g.a+=2;a=t;b=b+l+v;for(v=l=0;v<D;v++){var E=r(g);t=(E&2147483648)>>>31;var k=E&2147483647,ca=r(g);r(g);if(1==t){f=null;break a}var sb;sb=0==v&&e?e:new K(d,c,b,b+k-1);t=a/m;var dc=(a+ca)/m;0===v&&(l=t);h.push(new yd(t-l,dc-l,sb));
a+=ca;b+=k}h.b=m;f=h}}}}catch(Xa){if(!(Xa instanceof RangeError))throw Xa;}return f};function U(a,b){this.a=a;this.ea=0;this.b=b;this.h=[];this.Ga=!1;this.w=function(){}}U.prototype.J=function(){return!!this.h[this.h.length-1]};U.prototype.lastPollHadChanges=U.prototype.J;U.prototype.H=function(){var a=this.h,b=a.lastIndexOf(!0);if(1>b)return 0;a=a.lastIndexOf(!0,b-1);return 0>a?0:b-a-1};U.prototype.getFetchesBetweenRecentChanges=U.prototype.H;U.prototype.G=function(){return Math.floor((this.h.length-1-this.h.lastIndexOf(!0))/2)};U.prototype.getConsecutiveUpdatesWithoutChanges=U.prototype.G;
U.prototype.F=function(){return this.h.length-1-this.h.lastIndexOf(!1)};U.prototype.getConsecutiveUpdatesWithChanges=U.prototype.F;U.prototype.destroy=function(){this.a=null};U.prototype.length=function(){return this.a.length};U.prototype.D=function(){return(this.a||[]).slice()};U.prototype.getSegments=U.prototype.D;function V(a){if(0==a.a.length)throw new RangeError("SegmentIndex: There is no first SegmentReference.");return a.a[0]}
U.prototype.v=function(){if(0==this.a.length)throw new RangeError("SegmentIndex: There is no last SegmentReference.");return this.a[this.a.length-1]};U.prototype.last=U.prototype.v;n=U.prototype;n.get=function(a){if(0>a||a>=this.a.length)throw new RangeError("SegmentIndex: The specified index is out of range.");return this.a[a]};n.wa=function(a){a=Qb(this.a,a);return 0<=a?this.a[a]:null};n.Va=function(a){Od(this,a);return!0};
function Od(a,b){a.ea!=b.ea&&(b=new U(Md(b.a,a.ea-b.ea),b.b));if(0==a.length())a.a=b.a.slice(0);else if(0!=b.length()&&null!=a.v().endTime)if(null!=b.v().endTime&&b.v().endTime<a.v().endTime)VideoPlayerShakaExperiments.fixManifestWrapped?b.v().endTime<V(a).startTime&&(a.Ga=!0):a.Ga=!0;else{a.Ga=!1;if(a.v().endTime<=V(b).startTime)var c=Ld(a.v(),a.v().startTime,V(b).startTime),c=a.a.slice(0,-1).concat([c]);else{var d;for(d=0;d<a.a.length&&!(a.a[d].endTime>=V(b).startTime);++d);a.a[d].startTime<V(b).startTime?
(c=Ld(a.a[d],a.a[d].startTime,V(b).startTime),c=a.a.slice(0,d).concat([c])):(V(a).startTime>V(b).startTime||V(b),c=a.a.slice(0,d))}a.a=c.concat(b.a);a.w(b.a)}}n.ma=function(a){var b=a-this.ea;if(0==b)return 0;this.a=Md(this.a,b);this.ea=a;return b};n.Qa=function(){return 0<this.length()?{start:V(this).startTime,end:this.v().endTime}:{start:0,end:0}};
function Pd(a,b){var c=[];if(null===b||void 0===b)c=a.a;else{for(var d=0;d<a.a.length;d++){var e=a.a[a.a.length-d-1];e.startTime>=b&&c.push(e)}c.reverse()}return c.map(function(a,b){return Qd(a,b)}.bind(a))}function Qd(a,b){return{startTime:a.startTime,endTime:null===a.endTime?Number.POSITIVE_INFINITY:a.endTime,segmentID:b,requestInfo:sd(a.url)}}function Rd(a,b){a.w=b}function Sd(a){a.w=function(){}};function W(a,b,c,d,e){U.call(this,a,b);this.j=c;this.B=d;this.i=e;this.duration=this.j.b||this.j.a.reduce(function(a,b){return null==b.duration?NaN:a+b.duration},0)||0;this.c=this.u=this.g=null;Td(this)}q(W,U);W.prototype.destroy=function(){this.B=this.j=null;U.prototype.destroy.call(this)};W.prototype.wa=function(a){Ud(this,ya()/1E3);return U.prototype.wa.call(this,a)};
W.prototype.Va=function(a){if(!(a instanceof W))return!1;Od(this,a);this.duration=Math.max(this.duration,a.duration);null==this.g?(this.i=a.i,Td(this)):Vd(this);return!0};function Td(a){Vd(a);if(0!=a.length()){a.length();var b=null!=a.v().endTime?a.v().endTime:a.v().startTime;if(a.j.c>a.i)a.g=b;else{var c=a.i-(a.j.c+a.B.start);0>c?a.g=b:c<Math.max(a.v().startTime,a.v().endTime||0)?(a.v(),a.g=b):a.g=c}a.u=a.v().startTime;a.c=V(a).startTime}}
W.prototype.ma=function(a){a=U.prototype.ma.call(this,a);Math.min.apply(null,this.a.filter(function(a){return null!=a.endTime}).map(function(a){return a.endTime-a.startTime}));null!=this.g&&(this.u+=a,this.c+=a,this.g+=a);return a};W.prototype.Qa=function(){return Wd(this,ya()/1E3)};
function Wd(a,b){Ud(a,b);if(null==a.g||null==a.u||null==a.c)return{start:0,end:0};var c=Number.POSITIVE_INFINITY;a.duration&&(c=a.duration);var d=b-a.i,e=a.g+d;null!=a.j.f&&(e=e-a.c-a.j.f,0<e&&(a.c+=e));a.c=Math.min(a.c,c);d=a.u+d;if(d<a.c)return{start:a.c,end:a.c};d=0<a.length()?null!=a.v().endTime?Math.min(d,a.v().endTime):d:a.c;d=Math.max(d,a.c);d=Math.min(d,c);return{start:a.c,end:d}}
function Ud(a,b){Vd(a);if(null!=a.j.f)if(null==a.g)a.length();else{for(var c=a.g+(b-a.i),d=0,e=0;e<a.a.length;++e){var f=null;e<a.a.length-1?f=a.a[e+1].endTime:(f=a.a[e],f=null!=f.endTime?f.endTime+(f.endTime-f.startTime):null);if(null!=f&&f<c-a.j.f)++d;else break}0<d&&a.a.splice(0,d)}}function Vd(a){if(a.duration){for(var b=0,c=a.a.length-1;0<=c;--c)if(a.a[c].startTime>a.duration)++b;else break;0<b&&a.a.splice(-b)}};function Xd(a,b,c,d,e){var f=1,h=0,g;if(a.c>d)g=null;else{var l=a.i||0,k=a.f||0;g=c.a;g=g.a/g.b;var m=d-(a.c+b.start);0>m?g=null:(k=m-2*g-k,0>k&&(k=0),k=Math.ceil(k/g)*g,m-=g,0>m?g=null:(l=Math.floor(m/g)*g-l,0>l&&(l=0),l=Math.floor(l/g)*g,g={jb:k/g+1,current:(l>=k?l:k)/g+1}))}g&&(f=g.jb,h=g.current-g.jb+1);f=wd(e,c,f,h);if(null==f)throw a=Error("Failed to generate SegmentReferences."),a.type="stream",a;W.call(this,f,c.a.b||1,a,b,d);this.A=c;this.o=this.f=0<this.length()?a.c+b.start+this.v().endTime:
null;this.l=g?g.current+1:null;this.C=e}q(Xd,W);Xd.prototype.destroy=function(){this.C=this.A=null;W.prototype.destroy.call(this)};Xd.prototype.wa=function(a){var b=ya()/1E3;Yd(this,b);Ud(this,b);return U.prototype.wa.call(this,a)};Xd.prototype.Va=function(a){if(null!=this.f||!(a instanceof Xd)||null==a.f)return!1;this.f=a.f;this.o=a.o;this.l=a.l;this.i=a.i;this.duration=a.duration;Od(this,a);Yd(this,ya()/1E3);Td(this);return!0};
Xd.prototype.ma=function(a){a=W.prototype.ma.call(this,a);null!=this.f&&(this.f+=a,this.o+=a);return a};Xd.prototype.Qa=function(){var a=ya()/1E3;Yd(this,a);return Wd(this,a)};function Yd(a,b){if(null!=a.f&&null!=a.o&&null!=a.l){var c=a.A.a,c=c.a/c.b,d=Math.floor((a.o+(b-a.i)-a.f)/c);if(0!=d){var e=wd(a.C,a.A,a.l,d);Array.prototype.push.apply(a.a,Md(e,a.ea));a.f+=d*c;a.l+=d}}};function Zd(a,b,c,d,e){this.f=a;this.c=b;this.b=c;this.h=d;this.a=null;this.g=e}Zd.prototype.destroy=function(){this.g=this.b=this.c=this.f=null;this.a&&(this.a.destroy(),this.a=null)};
Zd.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.f.type)try{this.a=new Xd(this.f,this.c,this.b,this.h,this.g)}catch(a){return Promise.reject(a)}else{var b;b=this.b.a;if(b=wd(this.g,this.b,1,Math.ceil(this.c.duration/(b.a/b.b)))){if(0<b.length){var c=b[b.length-1];b[b.length-1]=Ld(c,c.startTime,this.c.duration)}b=new U(b,this.b.a.b||1)}else b=null;this.a=b;if(!this.a)return b=Error("Failed to generate SegmentReferences"),b.type="stream",Promise.reject(b)}return Promise.resolve(this.a)};function $d(a,b,c,d,e){this.c=a;this.b=b;this.g=c;this.a=null;this.h=d;this.f=e}$d.prototype.destroy=function(){this.f=this.g=this.b=this.c=null;this.a&&(this.a.destroy(),this.a=null)};
$d.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=this.g.b,b=[];a.f&&(b=Ad(a.f,a.b||1,this.b.duration||0));var c=0;a.c&&a.i?c=(a.i-1)*a.c:0<b.length&&(c=b[0].start-(a.g||0));var d=c,e=a.a.length;0<b.length&&b.length!=a.a.length&&(e=Math.min(b.length,a.a.length));for(var f=[],h=0;h<e;++h){var g=a.a[h],l=c/a.b,k=null,m=null,t;a.c?(k=c+a.c,m=k/a.b):0<b.length?(t=b[h].debugInfo,k=b[h].end-(a.g||0),m=k/a.b):(m=l+this.b.duration,k=m*a.b);var c=k,k=0,v=null;g.a&&(k=g.a.sa,v=g.a.end);
m=Math.min(this.b.duration+d/a.b,m);f.push(new yd(l,m,new K(this.f,g.b,k,v),null,t||null))}"dynamic"==this.c.type?this.a=new W(f,a.b||1,this.c,this.b,this.h):this.a=new U(f,a.b||1);return Promise.resolve(this.a)};function ae(a,b,c,d,e){this.b=a;this.c=b;this.f=c;this.h=d;this.a=null;this.g=e}ae.prototype.destroy=function(){this.g=this.f=this.c=this.b=null;this.a&&(this.a.destroy(),this.a=null)};
ae.prototype.create=function(){if(this.a)return Promise.resolve(this.a);for(var a=this.f.a,b=Ad(a.c,a.b||1,this.c.duration||0),c=[],d=0;d<b.length;++d){var e=b[d].start,f=b[d].debugInfo,h=e/a.b,g=b[d].end/a.b,l=xd(this.g,this.f,d+a.j,e);if(!l)return a=Error("Failed to generate media URL."),a.type="dash",Promise.reject(a);var k=(a.i||0)/a.b;c.push(new yd(h-k,g-k,l,e,f||null))}"dynamic"==this.b.type?this.a=new W(c,a.b||1,this.b,this.c,this.h):this.a=new U(c,a.b||1);return Promise.resolve(this.a)};function be(){this.K=ce++;this.id=this.M=this.I=null;this.b=0;this.height=this.width=this.bandwidth=null;this.c=this.a="";this.switchReason=this.f=this.fbQualityClass=this.fbQualityLabel=null;this.g=[];this.ia=!1;this.U=!0}var ce=0;be.prototype.destroy=function(){this.I&&(this.I.destroy(),this.I=null);this.M&&(this.M.destroy(),this.M=null)};function de(a){var b=a.a||"";a.c&&(b+='; codecs="'+a.c+'"');return b}
function ee(){this.K=fe++;this.id=null;this.contentType=this.lang="";this.f=this.b=!1;this.c=null;this.s=[];this.a=[]}var fe=0;ee.prototype.destroy=function(){for(var a=0;a<this.s.length;++a)this.s[a].destroy();this.a=this.s=null};function ob(a){for(var b=[],c=0;c<a.a.length;++c){var d=new ge;d.id=a.K;d.b=a.a[c];d.contentType=a.contentType;d.a=a.s.length?de(a.s[0]):"";b.push(d)}return b}function he(){this.id=null;this.start=0;this.duration=null;this.a=[]}
he.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function ie(){this.b=!1;this.i=this.g=this.f=null;this.c=0;this.a=[];this.h=!1;this.j="none"}ie.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function ge(){this.id=0;this.b=null;this.a=this.contentType=""};function je(a,b,c,d,e,f,h,g){F.call(this,a);this.a=b;this.b=new Fb(c,d,e,this,h);this.xa=h;this.g={};this.aa=e;this.ba=0;this.N=this.h=this.f=null;this.S=!1;this.l=this.G=null;this.A=!1;this.J=0;this.L=!1;this.u=null;this.T=this.i=!1;this.o=new J;this.w=this.j=!1;this.Z=this.C=0;this.H=15;this.qa=this.Y=this.B=!1;this.ca=f;this.$=!1;this.m=null;this.ra=!1;this.R=null;this.c=g||null;this.D=null;this.F=!1;this.ha={};this.O=!1;this.pa=0}q(je,F);je.prototype.ga=function(){return{SourceBufferManager:this.b}};
je.prototype.getDebug=je.prototype.ga;
je.prototype.P=function(a){null!=a.initialStreamBufferSize&&(this.C=Number(a.initialStreamBufferSize));null!=a.dynamicStreamBufferSize&&(this.J=Number(a.dynamicStreamBufferSize));null!=a.smartBufferAdjustmentParams&&(this.ha=a.smartBufferAdjustmentParams);null!=a.smartBufferAdjustmentEnabled&&(this.F=Boolean(a.smartBufferAdjustmentEnabled));null!=a.streamBufferSize&&(this.H=Number(a.streamBufferSize));null!=a.fixBufferingGoalDetermination&&(this.B=Boolean(a.fixBufferingGoalDetermination));null!=a.addCdnDebugQueryParameters&&
(this.Y=Boolean(a.addCdnDebugQueryParameters));null!=a.useInitialBufferSizeWhenPaused&&(this.qa=Boolean(a.useInitialBufferSizeWhenPaused));null!=a.segmentRequestTimeout&&(this.b.N=Number(a.segmentRequestTimeout));null!=a.resolveVideoTimeUpdateOnFragmentedTimeRanges&&(this.$=Boolean(a.resolveVideoTimeUpdateOnFragmentedTimeRanges));null!=a.performanceLogger&&(this.m=this.g.performanceLogger=a.performanceLogger);null!=a.abrLogger&&(this.g.abrLogger=a.abrLogger);null!=a.reappendInitSegmentAfterAbort&&
(this.g.reappendInitSegmentAfterAbort=Boolean(a.reappendInitSegmentAfterAbort));null!=a.liveDataFetchMaxRetries&&(this.g.liveDataFetchMaxRetries=Number(a.liveDataFetchMaxRetries));null!=a.liveSourceBufferClearMaxRetries&&(this.g.liveSourceBufferClearMaxRetries=Number(a.liveSourceBufferClearMaxRetries));null!=a.skipEmptySegments&&(this.g.skipEmptySegments=Boolean(a.skipEmptySegments));null!=a.playheadFragmentedGapDiffAllowance&&(this.g.playheadFragmentedGapDiffAllowance=Number(a.playheadFragmentedGapDiffAllowance));
null!=a.useMicroTaskTimeouts&&(this.ra=Boolean(a.useMicroTaskTimeouts));a=this.b;var b=this.g;null!=b.reappendInitSegmentAfterAbort&&(a.G=Boolean(b.reappendInitSegmentAfterAbort));null!=b.performanceLogger&&(a.m=b.performanceLogger);null!=b.abrLogger&&(a.H=b.abrLogger);null!=b.liveDataFetchMaxRetries&&(a.D=b.liveDataFetchMaxRetries);null!=b.liveSourceBufferClearMaxRetries&&(a.C=b.liveSourceBufferClearMaxRetries);null!=b.playheadFragmentedGapDiffAllowance&&(a.F=b.playheadFragmentedGapDiffAllowance);
null!=b.skipEmptySegments&&(a.P=b.skipEmptySegments)};je.prototype.destroy=function(){ke(this);this.o.destroy();this.aa=this.f=this.o=null;this.b.destroy();this.a=this.b=null;VideoPlayerShakaExperiments.fixingSchedulerDisableLeaks&&(this.c=null);this.oa=null};n=je.prototype;n.ta=function(){return this.f};n.Ra=function(){return this.h};n.Eb=function(a){this.j||a.then(function(){this.j=!0;this.l||le(this,0)}.bind(this)).catch(function(){});return this.o};n.Ta=function(){return this.w};
n.ya=function(a,b,c,d){if(a!=this.f){var e=a.M;e&&(this.N=e.create(this.m,this.xa));a.I.create().then(H(this,function(e){if(this.a){var h=this.f;this.f=a;var g=this.h;this.h=e;g&&Sd(g);Rd(this.h,function(){this.c&&me(this,this.f.id||"",this.h)}.bind(this));this.c&&me(this,a.id||"",e);this.S=!0;this.G=d?d:null;this.A||(h?b&&ne(this,!0,c):le(this,0))}})).catch(H(this,function(a){"aborted"!=a.type&&(this.j?(a=y(a),this.dispatchEvent(a)):this.o.reject(a))}))}};n.zb=function(){return ne(this,!1)};
n.Bb=function(){this.L=!0};n.Db=function(a){this.pa=a};function me(a,b,c){if(VideoPlayerShakaExperiments.useUpdateSegmentsByShakaReference)a.c.updateSegmentsByShakaReferences(b,c.D());else{var d;(d=0===c.a.length?null:Qd(c.v(),c.a.length-1))&&!a.c.hasSegment(d)&&(d=0<a.c.getSegments(b).length?a.a.currentTime-10:null,a.c.updateSegments(b,Pd(c,d)))}}
function ne(a,b,c){a.f&&!a.A&&(a.A=!0,ke(a),Ib(a.b).then(H(a,function(){var a=this.a.currentTime;VideoPlayerShakaExperiments.setCurrentTimeInResync&&0==a&&(a=V(this.h).startTime);if(!b&&0<Jb(this.b,a)&&0<=Qb(this.b.a,a))return Promise.resolve();if(c)return Tb(this.b,this.a.currentTime+c);this.O=!0;return Sb(this.b)})).then(H(a,function(){this.A=!1;le(this,0)})).catch(H(a,function(a){this.A=!1;"aborted"!=a.type&&(this.j?(a=y(a),this.dispatchEvent(a)):this.o.reject(a))})))}
n.Cb=function(a){return 0<Jb(this.b,a)&&0<=Qb(this.b.a,a)};n.Da=function(){};n.Pa=function(){return!0};
function oe(a){a.T=a.T||!a.a.paused;a.a.paused||a.F||(a.D=Date.now(),a.F=!0);var b=a.ha,c=null;if(b.inExperiment)if(b.useSmartBuffering){if(a.F&&a.D){var c=(Date.now()-a.D)/1E3,d=null;1>c?c=null:(d=3>c?b.bufferSize_00_to_03:10>c?b.bufferSize_03_to_10:30>c?b.bufferSize_10_to_30:60>c?b.bufferSize_30_to_60:b.bufferSize_above_60,c=Math.min(d,a.a.duration))}}else a.D&&(c=b.nonSmartBufferSize);c||(c=a.qa&&a.a.paused?a.C:a.H,a.J&&!a.a.paused&&(c=Math.max(Math.min(a.h.v().endTime-a.a.currentTime,a.J),a.H)));
c=(a.B?a.i&&a.T:a.i)?Math.max(a.C,c):a.C;0<VideoPlayerShakaExperiments.audioVideoBufferDiffThreshold&&(b=a.a.buffered.length?a.a.buffered.end(a.a.buffered.length-1):0,b=Math.max(0,b-a.a.currentTime),c=Math.min(c,b+VideoPlayerShakaExperiments.audioVideoBufferDiffThreshold));return c}
n.ub=function(){if(this.i&&!this.j)this.l=null;else{var a;if(a=this.j&&!this.w)a=1<this.b.c.buffered.length?!0:!1;if(a&&(this.L||Xb(this.b,this.a)))this.$&&(this.a.currentTime=Wb(this.a)),this.L=!1,ne(this,!0);else{this.l=null;a=this.f;var b=this.h,c=this.a.currentTime;VideoPlayerShakaExperiments.usePendingSeekPositionForReference&&0===this.a.readyState&&!c&&this.R&&(c=this.R);var d=this.i?c:c+(this.u||0);if(this.B&&!this.i&&Jb(this.b,d)>=VideoPlayerShakaExperiments.startStreamBufferSize)VideoPlayerShakaExperiments.fixChromeMSERegression&&
1===this.a.readyState&&0<this.a.buffered.length&&(this.a.currentTime=this.a.currentTime),pe(this),le(this,0);else if(Jb(this.b,d)>=oe(this))this.B||pe(this),le(this,1E3/(5*(Math.abs(this.a.playbackRate)||1)));else{var e=qe(this,c,b);e?(this.c&&(d={playhead:c,bufferStart:d,bufferEnd:Jb(this.b,d)+d,bufferingGoal:oe(this),isPlaying:!this.a.paused},this.c.updatePlayerState(a.id||"",d)),"video"===a.a.split("/")[0]&&this.aa.setRepresentationID(a.id),b=Mb(this.b,e,b.b,a.b+this.pa,this.N,this.Y&&!this.a.paused,
this.c),this.ca&&"video"===a.a.split("/")[0]&&this.ca(e.startTime,e.endTime,{id:a.id,reason:this.G,performanceLogger:this.m?this.m.getOperationLogger("stream_switch"):null}),this.N=null,this.S&&(this.S=!1,e=this.G,this.G=null,re(this,a,e)),this.w=!1,b.then(H(this,function(a){return VideoPlayerShakaExperiments.clearOldBuffer?Vb(this.b,this.a.currentTime).then(function(){return a}):a})).then(H(this,function(a){var b=a.ea;a=a.Yb;this.i||(this.ba=a);this.Z++;null==this.u&&(this.u=b);this.O&&0<Jb(this.b,
c)&&(this.O=!1,VideoPlayerShakaExperiments.disableNudge||(b=x({type:"should_nudge"}),this.dispatchEvent(b)));le(this,0)})).catch(H(this,function(a){if("aborted"!=a.type){var b=[0,404,410,502,503,504];"net"==a.type&&-1!=b.indexOf(a.sc.status)&&this.f&&le(this,1E3);a=y(a);this.dispatchEvent(a)}}))):(pe(this),this.j&&!this.w&&(this.w=!0,se(this)),le(this,200))}}}};
function qe(a,b,c){a=a.b;var d=a.a.length;a=0<d?a.a[d-1]:null;return null!=a?null!=a.endTime?c.wa(a.endTime):null:c.wa(b)||(c.length()?c.v():null)}function pe(a){if(!a.i&&null!=a.u){a.i=!0;var b=a.b,c=a.u,d=c-b.O;0!=d&&(b.a=Md(b.a,d),b.O=c);a.o.resolve(a.u)}}function re(a,b,c){var d=b.a.split("/")[0];b=x({type:"adaptation",id:b.id,bubbles:!0,contentType:d,size:"video"!=d?null:{width:b.width,height:b.height},bandwidth:b.bandwidth,reason:c});a.dispatchEvent(b)}
function se(a){var b=x({type:"ended"});a.dispatchEvent(b)}function le(a,b){ke(a);!b&&a.ra?Promise.resolve().then(a.ub.bind(a)):a.l=setTimeout(a.ub.bind(a),b)}function ke(a){null!=a.l&&(clearTimeout(a.l),a.l=null)}n.Ca=function(){return this.ba};function te(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d){for(var e=c.a[d],f=e,h=0;h<f.s.length;++h)gb(de(f.s[h]))||(f.s.splice(h,1),--h);0==e.s.length&&(c.a.splice(d,1),--d)}for(b=0;b<a.length;++b)for(c=a[b],d=0;d<c.a.length;++d)c.a[d].s.sort(ue)}function ue(a,b){var c=a.bandwidth||Number.MAX_VALUE,d=b.bandwidth||Number.MAX_VALUE;return c<d?-1:c>d?1:0};function ve(a){this.a=a}ve.prototype.destroy=function(){this.a.destroy();this.a=null};ve.prototype.update=function(a){var b=we(a),c=we(this.a);return Promise.all([b,c]).then(H(this,function(b){var c=b[0];b=b[1];te(this.a.a);a.b&&!this.a.b&&(a.h=!0);a.f=this.a.f;a.g=this.a.g?this.a.g.clone():null;a.c=this.a.c;var f=[];xe(a,this.a,c,b,f);te(a.a);return Promise.resolve(f)}))};
function we(a){function b(a,b){return a.concat(b)}var c=a.a.map(function(a){return a.a}).reduce(b,[]).map(function(a){return a.s}).reduce(b,[]);a=c.map(function(a){return a.I.create()});return Promise.all(a).then(function(a){for(var b={},f=0;f<c.length;++f)b[c[f].K]=a[f];return Promise.resolve(b)})}
function xe(a,b,c,d,e){var f=new B;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var h=new B;b.a.forEach(function(a,b){h.push(a.id||""+b,a)});a=bb(f);for(b=0;b<a.length;++b){var g=a[b],l=f.get(g);1<l.length||(g=h.get(g))&&0!=g.length&&1==g.length&&(ye(l[0],g[0],c,d,e),l[0].duration=g[0].duration)}}
function ye(a,b,c,d,e){var f=new B;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var h=new B;b.a.forEach(function(a,b){h.push(a.id||""+b,a)});a=bb(f);for(b=0;b<a.length;++b){var g=a[b],l=f.get(g);1<l.length||(g=h.get(g))&&0!=g.length&&1==g.length&&ze(l[0],g[0],c,d,e)}}
function ze(a,b,c,d,e){var f=new B;a.s.forEach(function(a,b){f.push(a.id||""+b,a)});var h=new B;b.s.forEach(function(a,b){h.push(a.id||""+b,a)});b={};for(var g=bb(f),l=0;l<g.length;++l){var k=g[l];b[k]=k;var m=f.get(k);1<m.length||((k=h.get(k))&&0!=k.length?1==k.length&&(Ae(m[0],k[0],c,d),m[0].M=k[0].M,k[0].M=null,m[0].b=k[0].b):(e.push(m[0]),a.s.splice(a.s.indexOf(m[0]),1)))}g=bb(h);for(l=0;l<g.length;++l)k=g[l],b[k]||(b[k]=k,k=h.get(k),a.s.push(k[0]))}
function Ae(a,b,c,d){a=c[a.K];d=d[b.K];b=a.length();a.Va(d)&&(d=a.length(),a.h.push(b!==d),50<a.h.length&&a.h.shift())};function Be(a){this.b=a;this.a=null}Be.prototype.destroy=function(){this.a&&(this.a.destroy(),this.a=null)};Be.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=new yd(0,null,this.b);this.a=new U([a],1);return Promise.resolve(this.a)};function Ce(a,b){F.call(this,a);this.c=b;this.h=!0;this.i=this.g=null;this.f=new J;this.a=null}q(Ce,F);Ce.prototype.P=function(){};Ce.prototype.destroy=function(){this.a&&this.c.removeChild(this.a);this.f.destroy();this.oa=this.c=this.g=this.i=this.a=this.f=null};n=Ce.prototype;n.ta=function(){return this.g};n.Ra=function(){return this.i};n.Eb=function(){return this.f};n.Ta=function(){return!0};
n.ya=function(a){a.I.create().then(H(this,function(b){if(this.c){if(0==b.length())return Promise.reject(Error("No subtitles URL available."));var c=this.g;this.g=a;this.i=b;b=V(b).url.c[0].toString();var d=this.Pa();this.a&&(this.Da(!1),this.c.removeChild(this.a));this.a=document.createElement("track");this.c.appendChild(this.a);this.a.src=b;this.Da(d);b=x({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:a.bandwidth});this.dispatchEvent(b);c||this.f.resolve(0)}}))};n.zb=function(){};
n.Bb=function(){};n.Cb=function(){return!0};n.Da=function(a){this.h=a;this.a&&(this.a.track.mode=a?"showing":"disabled")};n.Pa=function(){this.a&&(this.h="showing"==this.a.track.mode);return this.h};n.Ca=function(){return 0};n.Db=function(){};function De(){}
De.prototype.parse=function(a,b,c,d){var e=null;try{var f;var h=new Ha(b);if(440786851!=w(h).id)f=null;else{var g=w(h);if(408125543!=g.id)f=null;else{var l=g.a.byteOffset,k;var m=new Ha(g.a);for(b=null;Ca(m.a);){var t=w(m);if(357149030==t.id){b=t;break}}if(b){for(var v=new Ha(b.a),t=1E6,m=null;Ca(v.a);){var D=w(v);if(2807729==D.id)t=Ma(D);else if(17545==D.id)if(b=D,4==b.a.byteLength)m=b.a.getFloat32(0);else if(8==b.a.byteLength)m=b.a.getFloat64(0);else throw new RangeError("EbmlElement: floating point numbers must be 4 or 8 bytes.");}null==
m?k=null:(v=t/1E9,k={Wa:v,duration:m*v})}else k=null;f=k?{mc:l,Wa:k.Wa,duration:k.duration}:null}}if(f){var E=w(new Ha(a));if(475249515!=E.id)e=null;else{var ca=f.mc,sb=f.Wa,dc=f.duration;a=[];var Xa=new Ha(E.a);for(f=E=-1;Ca(Xa.a);){var Cd=w(Xa);if(187==Cd.id){var Ea;var Dd=new Ha(Cd.a),Ed=w(Dd);if(179!=Ed.id)Ea=null;else{var af=Ma(Ed),Fd=w(Dd);if(183!=Fd.id)Ea=null;else{for(var Gd=new Ha(Fd.a),l=0;Ca(Gd.a);){var Hd=w(Gd);if(241==Hd.id){l=Ma(Hd);break}}Ea={rc:af,lc:l}}}if(Ea){var Id=sb*Ea.rc,Jd=
ca+Ea.lc;if(0<=E){var tc=new K(d,c,f,Jd-1);a.push(new yd(E,Id,tc))}E=Id;f=Jd}}}0<=E&&(tc=new K(d,c,f,null),a.push(new yd(E,dc,tc)));e=a}}else e=null}catch(Kd){if(!(Kd instanceof RangeError))throw Kd;}return e};function Ee(a,b,c,d,e,f,h,g,l){this.g=a;this.i=b;this.f=c;this.a=d;this.c=e;this.b=f;this.j=h;this.la=null;this.h=g;this.m=l||null}Ee.prototype.destroy=function(){this.h=this.i=this.g=null;this.a.h();this.a=null;this.b&&(this.b.h(),this.b=null);this.c&&(this.c.h(),this.c=null);this.la=null};Ee.prototype.Xb=function(){return this.la};Ee.prototype.create=function(){return Fe(this)};Ee.prototype.Aa=function(){return Fe(this)};
function Fe(a){if(a.la)return a.la;var b=null;a.m&&(b=a.m.getOperationLogger("create_container_segment_index_source").start());var c=[Ob(a.a,null,null,a.m,b)];"webm"==a.f&&c.push(Ob(a.c,null,null,a.m,b));a.la=Promise.all(c).then(H(a,function(a){var c=a[0];a=a[1]||null;var f=null;"mp4"==this.f?(f=new Nd,f=f.parse(new DataView(c),this.a.startByte,this.a.c,this.h,this.b)):"webm"==this.f&&(f=new De,f=f.parse(new DataView(c),new DataView(a),this.a.c,this.h));if(!f)return c=Error("Failed to parse SegmentReferences from "+
this.a.toString()+" (or one of its fallbacks)."),c.type="stream",Promise.reject(c);var h;"dynamic"==this.g.type?h=new W(f,f.b,this.g,this.i,this.j):h=new U(f,f.b);b&&b.log();return Promise.resolve(h)}));return a.la};function Ge(a,b){this.a=a;this.m=b||null}
function He(a,b,c){for(var d=ya()/1E3,e=0;e<b.a.length;++e)for(var f=b.a[e],h=0;h<f.a.length;++h){var g=f.a[h];if("text"!=g.contentType)for(var l=0;l<g.a.length;++l){var k=g.a[l],m=0,m=m+(k.g?1:0),m=m+(k.b?1:0),m=m+(k.a?1:0);0==m?(g.a.splice(l,1),--l):1!=m&&(k.g?(k.b=null,k.a=null):k.b&&(k.a=null))}}Ie(b);for(e=0;e<b.a.length;++e)for(f=b.a[e],h=0;h<f.a.length;++h){l=g=f.a[h];k=null;for(m=0;m<l.a.length;++m){var t=l.a[m].f||"";k?t!=k&&(l.a.splice(m,1),--m):k=t}0==g.a.length&&(f.a.splice(h,1),--h)}"dynamic"==
b.type&&null==b.c&&(b.c=d);e=new ie;"dynamic"==b.type&&(e.b=!0,e.f=b.g,e.g=new K(c,b.j||b.url),e.i=b.c);e.c=b.h||5;for(f=0;f<b.a.length;++f){h=b.a[f];if(null==h.start)break;h=Je(a,b,h,d,c);e.a.push(h)}a="none";for(f=0;f<b.a.length;f++)for(h=b.a[f],c=0;c<h.a.length;c++)for(d=h.a[c],g=0;g<d.a.length;g++)l=d.a[g].h,null!=l&&null!=l.value&&(a=l.value,"urn:mpeg:dash:23003:3:audio_channel_configuration:2011"===l.a&&("1"===a?a="mono":"2"===a&&(a="stereo")));e.j=a;return e}
function Ie(a){if(a.a.length){null==a.a[0].start&&(a.a[0].start=0);var b=function(a){return 0==a||!!a};"dynamic"==a.type&&(a.b=null);b(a.b)&&1==a.a.length&&!b(a.a[0].duration)&&(a.a[0].duration=a.b);for(var c=0,d=!0,e=0;e<a.a.length;++e){var f=a.a[e-1],h=a.a[e],g=a.a[e+1]||{start:a.b};!b(h.start)&&f&&b(f.start)&&b(f.duration)&&(h.start=f.start+f.duration);!b(h.duration)&&b(g.start)&&(h.duration=g.start-h.start);null!=h.start&&null!=h.duration?c+=h.duration:d=!1}b(a.b)||(e=a.a[a.a.length-1],d?a.b=
c:b(e.start)&&b(e.duration)?a.b=e.start+e.duration:"dynamic"!=a.type&&(a.b=c))}}
function Je(a,b,c,d,e){var f=new he;f.id=c.id;f.start=c.start;f.duration=c.duration;var h=new B;c.a.forEach(function(a){h.push(a.contentType||"",a)});for(var g=bb(h),l=0;l<g.length;++l){var k=new B;h.get(g[l]).forEach(function(a){k.push(a.group,a)});for(var m=bb(k),t=0;t<m.length;++t){var v=new B;k.get(m[t]).forEach(function(a){v.push(a.lang,a)});for(var D=bb(v),E=0;E<D.length;++E){var ca=v.get(D[E]),ca=Ke(a,b,c,ca,d,e);f.a.push(ca)}}}return f}
function Ke(a,b,c,d,e,f){ba(d.every(function(a){return a.group==d[0].group&&(a.lang||"")==(d[0].lang||"")&&(a.contentType||"")==(d[0].contentType||"")}));var h=new ee,g=d.filter(function(a){return null!=a.id});g.length==d.length&&(h.id=g.map(function(a){return a.id}).sort().reduce(function(a,b){return a+","+b}));h.b=!(!d[0].c||"urn:scte:dash:cc:cea-608:2015"!==d[0].c.a);h.lang=d[0].lang||"";h.contentType=d[0].contentType||"";h.f=d.some(function(a){return a.g});for(var g={},l=0;l<d.length;++l){var k=
d[l];k.f&&(h.c=k.f);for(var m=0;m<k.a.length;++m){var t=k.a[m],v=Le(a,t),D=h.a.slice(0);Me(v,D);0==D.length&&0<h.a.length||!(t=Ne(a,b,c,t,e,f))||(h.s.push(t),h.a=D,g[t.K]=k)}}if(h.a.some(function(a){return""==a.b}))return h.s.forEach(function(a){a.ia=!0}),h;a=Oe(d);for(l=0;l<h.s.length;++l)t=h.s[l],k=g[t.K],k==a&&(t.ia=!0);return h}
function Oe(a){for(var b=null,c=null,d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.a.length;++f){var h=e.a[f],h=(h.width||1)*(h.height||1)*(h.bandwidth||1);if(null==b||h<b)b=h,c=e}return c}function Me(a,b){if(0==b.length)Array.prototype.push.apply(b,a);else for(var c=0;c<b.length;++c){for(var d=!1,e=0;e<a.length;++e){var f=b[c],h=a[e];if(f.b==h.b&&f.g==h.g&&f.l==h.l&&f.f==h.f&&f.h==h.h&&f.c==h.c&&f.j==h.j&&Ka(f.i,h.i)){d=!0;cc(b[c],a[e].a);break}}d||(b.splice(c,1),--c)}}
function Le(a,b){var c=[];if(0==b.c.length)c.push(new bc);else if(a.a)for(var d=0;d<b.c.length;++d)c.push.apply(c,Pe(a,b.c[d]));return c}
function Pe(a,b){var c=[];if(2!=a.a.length)return[];var d=a.a(b.f||"",b.c);if(!(d&&d instanceof Array))return[];for(var e=0;e<d.length;++e){var f;var h=d[e];f=new bc;if(h){var g=Ya(h,"keySystem");if(null!=g)f.b=g;else throw Error("'keySystem' cannot be null.");var l=Ya(h,"licenseServerUrl");if(null!=l)f.g=l;else if(g)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");g=z(h,"withCredentials");null!=g&&(f.l=g);g=Za(h,"licensePostProcessor",Function);null!=g&&
(f.o=g);g=Za(h,"licensePreProcessor",Function);null!=g&&(f.u=g);g=z(h,"distinctiveIdentifierRequired");null!=g&&(f.f=g);g=z(h,"persistentStateRequired");null!=g&&(f.h=g);g=Ya(h,"audioRobustness");null!=g&&(f.c=g);g=Ya(h,"videoRobustness");null!=g&&(f.j=g);g=Za(h,"serverCertificate",Uint8Array);null!=g&&(f.i=g);if(g=Za(h,"initData",Object)){h=Za(g,"initData",Uint8Array);if(null==h)throw Error("'initData.initData' cannot be null.");g=Ya(g,"initDataType");if(null==g)throw Error("'initData.initDataType' cannot be null.");
f.a.push({initData:new Uint8Array(h.buffer),initDataType:g})}}0==f.a.length&&b.a&&b.a.psshBox&&cc(f,[{initData:b.a.psshBox,initDataType:"cenc"}]);c.push(f)}return c}
function Ne(a,b,c,d,e,f){if(!d.baseUrl||0===d.baseUrl.length)return null;var h=null,g=1,l=0;if(d.g){h=d.f.split("/")[1];if("mp4"!=h&&"webm"!=h)h=null;else{var k=d.g;"webm"!=h||k.f?k.a||k.c&&k.c.a?(g=k.c,g||(g=new Jc,g.url=d.baseUrl,g.a=k.a?k.a.clone():null),l=Qe(g,f),g=k.f?Qe(k.f,f):null,k.g?(k=k.g,k=new K(f,d.baseUrl,k.sa,k.end)):k=null,b=new Ee(b,c,h,l,g,k,e,f,a.m),c=new Bd(g),e=new be,e.I=b,e.M=c,h=e):h=null:h=null}g=d.g.b;l=d.g.h}else if(d.b)a=d.b,!a.c&&!a.f&&1<a.a.length?h=null:a.c||c.duration||
a.f||1!=a.a.length?a.f&&0===a.f.a.length?h=null:(a=a.h?Qe(a.h,f):null,b=new $d(b,c,d,e,f),c=new Bd(a),e=new be,e.I=b,e.M=c,h=e):h=null,g=d.b.b,l=d.b.g;else if(d.a){a:if(h=d.a,g=0+(h.f?1:0),g+=h.c?1:0,g+=h.a?1:0,0==g?g=!1:(1!=g&&(h.f?(h.c=null,h.a=null):h.c&&(h.a=null)),g=!0),g){g=null;if(h.g&&(g=(h=d.a.g)?Re(d,h,Kc):null,!g)){h=null;break a}h=g?Qe(g,f):null;g=d.a;g.f?(g=d.f.split("/")[1],"mp4"!=g&&"webm"!=g?b=null:"webm"!=g||h?xd(f,d,1,0)?(l=(l=d.a.f)?Re(d,l,Jc):null)?(l=Qe(l,f),b=new Ee(b,c,g,l,
h,null,e,f,a.m)):b=null:b=null:b=null):b=g.h?g.c?new ae(b,c,d,e,f):g.a?"dynamic"!=b.type&&null==c.duration?null:new Zd(b,c,d,e,f):null:null;b?(c=new Bd(h),e=new be,e.I=b,e.M=c,h=e):h=null}else h=null;g=d.a.b;l=d.a.i}else"text"==d.f.split("/")[0]&&(h=new be,h.I=new Be(new K(f,d.baseUrl)));if(!h)return null;h.id=d.id;l&&(h.b=-1*l/g);h.bandwidth=d.bandwidth;h.width=d.width;h.height=d.height;h.a=d.f||"";h.c=d.i||"";h.fbQualityLabel=d.fbQualityLabel||null;h.fbQualityClass=d.fbQualityClass||null;h.f=d.j||
null;for(b=0;b<d.c.length;++b)c=d.c[b],c.b&&h.g.push(c.b);return h}function Re(a,b,c){b=zd(b,a.id,null,a.bandwidth,null);if(!b)return null;c=new c;c.url=pd(a.baseUrl,b);return c}function Qe(a,b){var c=a.url,d=0,e=null;a.a&&(d=a.a.sa,e=a.a.end);return new K(b,c,d,e)};function X(){this.a=this.b=null;this.f=new cb;this.c=Number.POSITIVE_INFINITY;this.i=!0;this.g=!1}p("shaka.media.SimpleAbrManager",X);X.prototype.destroy=function(){this.f.destroy();this.a=this.b=this.f=null};X.prototype.initialize=function(a,b){this.b||this.a||(this.b=a,this.a=b)};
X.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=Date.now()+4E3,C(this.f,this.b,"bandwidth",this.l.bind(this)),C(this.f,this.a,"adaptation",this.j.bind(this)),C(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)};X.prototype.enable=function(a){this.i=a};X.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var a=Se(this);return a?a.id:null};X.prototype.getInitialSwitchReason=function(){return null};X.prototype.getInitialAudioTrackId=function(){return null};
X.prototype.selectVideoTrack=function(a,b,c){this.g&&this.a.selectVideoTrack(a.id,b,c)};X.prototype.l=function(){Date.now()<this.c||this.h()};X.prototype.h=function(){if(this.i){var a=Se(this);if(a){if(a.active){this.c=Date.now()+3E3;return}this.selectVideoTrack(a,!1)}this.c=Number.POSITIVE_INFINITY}};X.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=Date.now()+3E4)};
function Se(a){var b=a.a.R();if(0==b.length)return null;b.sort(va);var c;a:{c=a.a.Sa();for(var d=0;d<c.length;++d)if(c[d].active){c=c[d];break a}c=null}c=c?c.bandwidth:0;a=a.b.getBandwidth();for(var d=b[0],e=0;e<b.length;++e){var f=b[e],h=e+1<b.length?b[e+1]:{bandwidth:Number.POSITIVE_INFINITY};if(f.bandwidth&&(h=(h.bandwidth+c)/.85,a>=(f.bandwidth+c)/.95&&a<=h&&(d=f,d.active)))break}return d};function Y(a,b,c){F.call(this,null);this.a=a;this.ca=b;this.Lb=new VideoPlayerLocalBandwidthEstimator(this,b);this.h=new cb;this.i=new MediaSource;this.J=this.b=null;this.Ua=0;this.eb=this.xb=!1;this.Na=0;this.cb=this.m=null;this.Ma=3;this.Ka=this.yb=!1;this.Ja=0;this.V=new kd;this.N=null;this.Mb=1;this.Jb=Infinity;this.qb=this.ob=!1;this.Z=this.Ia=null;this.rb=this.ra=this.Ab=this.Y=!1;this.f=new B;this.o=c;this.o.initialize(b,this);this.C=!1;this.F="en";this.ha=!1;this.B=new J;this.La=new J;this.j=
new la;this.w=null;this.Za=1;this.c={};this.$=new J;this.O=0;this.Kb=15;this.A=null;this.Hb=!1;this.Gb=0;this.pa=!1;this.u={};this.T=this.P=this.L=null;this.g={};this.ba=!1;this.fb=null;this.l={};this.D=null}q(Y,F);p("shaka.player.StreamVideoSource",Y);Y.prototype.wb=function(){return{VideoSourceStream:this.c.video,AudioSourceStream:this.c.audio,TextSourceStream:this.c.text,BandwidthEstimator:this.ca}};Y.prototype.getStreamDebug=Y.prototype.wb;Y.prototype.Qb=function(){return this.a?this.a.j:"none"};
Y.prototype.getMpAudioConfigDebug=Y.prototype.Qb;
Y.prototype.$a=function(a){null!=a.streamBufferSize&&(this.g.streamBufferSize=a.streamBufferSize);null!=a.initialStreamBufferSize&&(this.g.initialStreamBufferSize=a.initialStreamBufferSize);null!=a.dynamicStreamBufferSize&&(this.g.dynamicStreamBufferSize=a.dynamicStreamBufferSize);null!=a.smartBufferAdjustmentParams&&(this.g.smartBufferAdjustmentParams=a.smartBufferAdjustmentParams);null!=a.addCdnDebugQueryParameters&&(this.g.addCdnDebugQueryParameters=a.addCdnDebugQueryParameters);null!=a.segmentRequestTimeout&&
(this.g.segmentRequestTimeout=a.segmentRequestTimeout);null!=a.resolveVideoTimeUpdateOnFragmentedTimeRanges&&(this.g.resolveVideoTimeUpdateOnFragmentedTimeRanges=a.resolveVideoTimeUpdateOnFragmentedTimeRanges);null!=a.reappendInitSegmentAfterAbort&&(this.g.reappendInitSegmentAfterAbort=a.reappendInitSegmentAfterAbort);null!=a.liveDataFetchMaxRetries&&(this.g.liveDataFetchMaxRetries=a.liveDataFetchMaxRetries);null!=a.liveSourceBufferClearMaxRetries&&(this.g.liveSourceBufferClearMaxRetries=a.liveSourceBufferClearMaxRetries);
null!=a.playheadFragmentedGapDiffAllowance&&(this.g.playheadFragmentedGapDiffAllowance=a.playheadFragmentedGapDiffAllowance);null!=a.fixBufferingGoalDetermination&&(this.g.fixBufferingGoalDetermination=a.fixBufferingGoalDetermination);null!=a.skipEmptySegments&&(this.g.skipEmptySegments=a.skipEmptySegments);null!=a.useMicroTaskTimeouts&&(this.g.useMicroTaskTimeouts=a.useMicroTaskTimeouts);Te(this);null!=a.includeStreamBufferSizeInStartOffset&&(this.xb=Boolean(a.includeStreamBufferSizeInStartOffset));
null!=a.liveAudioPushRepresentation&&(this.Z=String(a.liveAudioPushRepresentation));null!=a.liveInitialPushRepresentation&&(this.Ia=String(a.liveInitialPushRepresentation));null!=a.enableAdaptation&&this.o.enable(Boolean(a.enableAdaptation));null!=a.mpdRequestTimeout&&(this.Na=Number(a.mpdRequestTimeout));null!=a.minMpdRefreshInterval&&(this.Ma=Number(a.minMpdRefreshInterval)/1E3);null!=a.enableManifestDebug&&(this.qb=!!a.enableManifestDebug);null!=a.liveStreamEndTimeout&&(this.Kb=Number(a.liveStreamEndTimeout));
null!=a.preferredLanguage&&(this.F=Ra(String(a.preferredLanguage)));null!=a.liveSendPushHeaders&&(this.Ka=Boolean(a.liveSendPushHeaders));null!=a.liveMaxManifestFetchesWithPush&&(this.Ja=Number(a.liveMaxManifestFetchesWithPush));null!=a.currentTimeDuringReadyStateZeroThrows&&(this.ob=Boolean(a.currentTimeDuringReadyStateZeroThrows));null!=a.liveMaxSegmentsToPush&&(this.Jb=Number(a.liveMaxSegmentsToPush));null!=a.jumpToLiveThreshold&&(this.Gb=Number(a.jumpToLiveThreshold));null!=a.restrictions&&(this.j=
a.restrictions,this.C&&Ue(this));null!=a.useLongCacheForManifest&&(this.Y=Boolean(a.useLongCacheForManifest));null!=a.jumpToEarliestPositionInCurrentBlock&&(this.Ab=Boolean(a.jumpToEarliestPositionInCurrentBlock));null!=a.ignoreMinBufferTime&&(this.ra=Boolean(a.ignoreMinBufferTime));null!==a.enableRequestPipelining&&(this.rb=Boolean(a.enableRequestPipelining))};
Y.prototype.destroy=function(){this.B.destroy();this.$.destroy();this.$=this.B=null;this.P&&(clearTimeout(this.P),this.P=null);this.L&&(clearTimeout(this.L),this.L=null);this.u=null;this.h.destroy();this.h=null;Va(this.c).forEach(function(a){a.destroy()});this.f=this.c=null;this.a&&(this.a.destroy(),this.a=null);this.o.destroy();this.oa=this.j=this.b=this.i=this.ca=this.o=null;VideoPlayerShakaExperiments.fixingSchedulerDisableLeaks&&(Object.keys(this.l).forEach(function(a){this.l[a].disable()}.bind(this)),
this.l={});this.D&&(this.D.cleanup(),this.D=null)};function mb(a,b){if(a.m){var c=a.m.getOperationLogger("media_source_open").start();a.La.then(function(){c.log()})}C(a.h,a.i,"sourceopen",a.dc.bind(a));b.src=window.URL.createObjectURL(a.i)}n=Y.prototype;n.kb=function(){};
function qb(a,b,c){var d;a.m&&(d=a.m.getOperationLogger("source_attach").start());if(!a.C)return a=Error("Cannot call attach() right now."),a.type="app",d&&d.setError(a).log(),Promise.reject(a);a.oa=b;a.b=c;a.J=null;VideoPlayerShakaExperiments.enableViewportPriorityAdjustment&&(a.D=new ViewportPriorityAdjuster(a.b),a.D.setOnPriorityChanged(function(a){Object.keys(this.l).forEach(function(b){this.l[b].updatePriorityWithNewAdjustment(a)}.bind(this))}.bind(a)));C(a.h,a.b,"loadedmetadata",a.cc.bind(a));
C(a.h,a.ca,"bandwidth",a.qc.bind(a));a.a.b&&(C(a.h,b,"bufferingStart",a.ac.bind(a)),C(a.h,b,"bufferingEnd",a.$b.bind(a)));Ve(a).then(H(a,function(){d&&this.S()&&d.setLiveheadPosition(We(Xe(this)));this.B&&this.B.resolve();this.kb()})).catch(H(a,function(a){this.B&&this.B.reject(a)}));return a.B.then(function(){d&&d.log()})}
n.Ea=function(){if(this.C){var a=Error("Cannot call load() right now.");a.type="app";return Promise.reject(a)}if(!this.a||0==this.a.a.length)return a=Error("The manifest does not specify any content."),a.type="stream",Promise.reject(a);te(this.a.a);if(0==this.a.a.length||0==this.a.a[0].a.length||!this.a.a[0].a.some(function(a){return"video"===a.contentType}))return a=Error("The manifest specifies content that cannot be displayed on this browser/platform."),a.type="stream",Promise.reject(a);this.C=
!0;this.ra||(this.g.initialStreamBufferSize=Math.max(this.g.initialStreamBufferSize||0,this.a.c));Te(this);Ue(this);return Promise.resolve()};function Ye(a){var b=x({type:"manifestwrapped",bubbles:!0});a.dispatchEvent(b)}function We(a){return Math.min.apply(Math,a.map(function(a){return a.length()?a.v().endTime:null}).filter(function(a){return!!a}))}
n.Xa=function(a,b){var c;this.m&&(c=this.m.getOperationLogger("update_manifest").start());if(!b||this.C){var d=Date.now(),e=this.L=null,f,h;if(this.Ka&&(!this.Ja||this.Ja>this.Mb)){f=Math.floor(Ze(this))+1;f=Math.min(f,this.Jb);var g=this.c.video;if(g=g?g.Ra():null)g=g.v(),null!=g.a&&(h=g.a);if(this.b.paused||this.ba)f=0}f&&this.Mb++;g=this.a.g;c&&!a&&c.setResource(g.toString());(a?this.sb():this.tb(g,f,h)).then(H(this,function(a){e=new ve(a);return e.update(this.a)})).then(H(this,function(a){e.destroy();
e=null;var g=Xe(this);this.ja("SegmentIndexesUpdated",g);g.some(function(a){return a.Ga})&&Ye(this);var f=$e(this,g);c&&this.S()&&c.setLiveheadPosition(We(g));f&&this.a.b&&this.b.paused&&f.end>this.b.currentTime+10&&(this.b.currentTime=f.end);VideoPlayerShakaExperiments.skipRemainingBufferedOnStreamEnd&&f&&this.a.b&&this.a.h&&this.b.paused&&(this.b.currentTime=this.O-.1);if(yb(this))return c&&c.log(),this.Ba();for(g=0;g<a.length;++g)bf(this,a[g]);this.ra||(this.g.initialStreamBufferSize=Math.max(this.g.initialStreamBufferSize||
0,this.a.c));this.g.useInitialBufferSizeWhenPaused=this.a.b;Te(this);Ue(this);0==Object.keys(this.c).length?Ve(this):(a=Date.now(),b||cf(this,(a-d)/1E3));c&&c.log()})).catch(H(this,function(a){c&&c.setError(a).log();e&&(e.destroy(),e=null);if(!b){if("delay"==a.type)return cf(this,0);"aborted"!=a.type&&(a=y(a),this.dispatchEvent(a),this.a&&cf(this,0))}}))}};n.tb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};n.sb=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};
function cf(a,b){if(null!=a.a.f){var c=Math.max(a.a.f,a.Ma),c=Math.max(c-b,0),d=a.Xa.bind(a,!1);if(!c&&a.g.useMicroTaskTimeouts)return Promise.resolve().then(d);a.L=setTimeout(d,1E3*c)}}
function bf(a,b){var c=b.a.split("/")[0],d=a.c[c];if(d&&d.ta()==b){var e=a.f.get(b.a.split("/")[0]).map(function(a){return a.s}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return a.ia&&a.U});if(0==e.length){c=Error("All usable streams have been removed from the manifest.");c.type="app";c=y(c);a.dispatchEvent(c);return}a.u[c].Fb==b&&delete a.u[c];d.ya(e[0],!0);b.destroy()}b.destroy()}n.nc=function(a){this.fb=a};Y.prototype.setTaggedTimeRangesEntryAdder=Y.prototype.nc;
Y.prototype.Ob=function(){if(!this.f||!this.f.a.hasOwnProperty("video"))return 0;var a=this.c.video;return a?a.Z:0};Y.prototype.getFetchedVideoSegmentsCount=Y.prototype.Ob;
Y.prototype.R=function(){if(!this.f||!this.f.a.hasOwnProperty("video"))return[];for(var a=this.c.video,a=(a=a?a.ta():null)?a.K:0,b=[],c=this.f.get("video"),d=0;d<c.length;++d)for(var e=c[d],f=0;f<e.s.length;++f){var h=e.s[f];if(h.ia&&h.U){var g=h.K,h=new ua(g,h.bandwidth,h.width,h.height,h.id,h.fbQualityLabel,h.fbQualityClass,h.f);g==a&&(h.active=!0);b.push(h)}}return b};Y.prototype.getVideoTracks=Y.prototype.R;
Y.prototype.Rb=function(){if(this.N)return this.N;if(!this.a)return null;for(var a=0;a<this.a.a.length;++a)for(var b=this.a.a[a],c=0;c<b.a.length;++c)if(this.N=b.a[c].c)return this.N;return null};Y.prototype.getVideoProjection=Y.prototype.Rb;Y.prototype.Pb=function(){return this.Lb};Y.prototype.getLocalEstimator=Y.prototype.Pb;function df(a){a=a.R();for(var b=0;b<a.length;b++)if(a[b].active)return a[b]}
Y.prototype.Sa=function(){if(!this.f||!this.f.a.hasOwnProperty("audio"))return[];for(var a=this.c.audio,a=(a=a?a.ta():null)?a.K:0,b=[],c=this.f.get("audio"),d=0;d<c.length;++d)for(var e=c[d],f=e.lang,h=0;h<e.s.length;++h){var g=e.s[h];if(g.ia&&g.U){var l=g.K,g=new ka(l,g.bandwidth,f,g.id);l==a&&(g.active=!0);b.push(g)}}return b};Y.prototype.getAudioTracks=Y.prototype.Sa;
Y.prototype.ab=function(){if(!this.f||!this.f.a.hasOwnProperty("text"))return[];for(var a=this.c.text,b=a?a.ta():null,b=b?b.K:0,c=[],d=this.f.get("text"),e=0;e<d.length;++e)for(var f=d[e],h=f.lang,g=0;g<f.s.length;++g){var l=f.s[g].K,k=new ta(l,h);l==b&&(k.active=!0,k.enabled=a.Pa());c.push(k)}return c};Y.prototype.getTextTracks=Y.prototype.ab;function xb(a){var b=Number(a.g.initialStreamBufferSize);a.g.fixBufferingGoalDetermination&&(b=1);return a.yb?Number(a.g.streamBufferSize):b}
Y.prototype.selectVideoTrack=function(a,b,c,d){return ub(this,"video",a,b,c,d)};function vb(a,b){var c=a.c.text;c&&c.Da(b)}
function Ue(a){if(a.j){for(var b=!1,c=0;c<a.a.a.length;++c)for(var d=a.a.a[c],e=0;e<d.a.length;++e){var f=d.a[e];if("video"==f.contentType)for(var h=0;h<f.s.length;++h){var g=f.s[h],l=g.U;g.U=!0;a.j.maxWidth&&g.width>a.j.maxWidth&&(g.U=!1);a.j.maxHeight&&g.height>a.j.maxHeight&&(g.U=!1);a.j.minHeight&&g.height<a.j.minHeight&&(g.U=!1);a.j.maxBandwidth&&g.bandwidth>a.j.maxBandwidth&&(g.U=!1);a.j.minBandwidth&&g.bandwidth<a.j.minBandwidth&&(g.U=!1);l!=g.U&&(b=!0)}}0!=$a(a.f).length&&b&&(b=x({type:"trackschanged",
bubbles:!0}),a.dispatchEvent(b),0<a.R().length||(b=Error("The application has restricted all video tracks!"),b.type="app",b=y(b),a.dispatchEvent(b)))}}Y.prototype.S=function(){return this.a?this.a.b:null};Y.prototype.isLive=Y.prototype.S;Y.prototype.Sb=function(a){this.yb=a};Y.prototype.setIsLiveInterrupted=Y.prototype.Sb;Y.prototype.Vb=function(){for(var a in this.c)this.c[a].Bb()};Y.prototype.forceResyncVideoBuffer=Y.prototype.Vb;
function ub(a,b,c,d,e,f){if(!a.f.a.hasOwnProperty(b)||!a.c[b])return!1;for(var h=a.f.get(b),g=0;g<h.length;++g)for(var l=h[g],k=0;k<l.s.length;++k){var m=l.s[k];if(m.K==c){if(!m.ia||!m.U)return!1;if("text"!=b&&!a.pa)return c=a.u[b],a.u[b]={Fb:m,hb:null!=c&&c.hb||d,ib:null!=c&&c.ib||e,switchReason:f},!0;a.c[b].ya(m,d,e,f);return!0}}return!1}
function pb(a,b){for(var c=0;2>=c;++c)for(var d=0;d<b.length;++d){var e=b[d];if(Qa(c,a.F,e.lang)){b.splice(d,1);b.splice(0,0,e);return}}for(d=0;d<b.length;++d)if(e=b[d],e.f){b.splice(d,1);b.splice(0,0,e);break}}n=Y.prototype;n.dc=function(){this.h.za(this.i,"sourceopen");this.La.resolve()};
function Ve(a){var b;a.m&&(b=a.m.getOperationLogger("start_streams").start());for(var c=[],d=["audio","video","text"],e=0;e<d.length;++e){var f=d[e];a.f.a.hasOwnProperty(f)&&c.push(a.f.get(f)[0])}for(var h=ef(a,c),e=0;e<d.length;++e)if(f=d[e],a.f.a.hasOwnProperty(f)&&!h[f])return a=Error("Unable to select an initial "+f+" stream: all "+f+" streams have been restricted (by the application or by the key system)."),a.type="stream",b&&b.setError(a).log(),Promise.reject(a);c=Va(h).map(function(a){return a.I.create()});
c.push(a.La);return Promise.all(c).then(H(a,function(a){a.pop();if(!a.every(function(a){return a.length()}))return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);a=$e(this,a);if(!a)return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);if(!ff(this,h))return a=Error("Failed to create Stream objects."),a.type="stream",Promise.reject(a);this.o.start();gf(this,h,a);return Promise.resolve()})).then(function(){b&&b.log()}).catch(H(a,function(a){if("aborted"==
a.type)b&&b.setError(a).log();else{Object.keys(this.c);if(this.a.b)return ya()<this.a.i?(a=Math.max(this.a.i-Date.now()/1E3,this.Ma),this.L=setTimeout(this.Xa.bind(this,!0),1E3*a)):cf(this,0),b&&b.log(),Promise.resolve();b&&b.setError(a).log();return Promise.reject(a)}}))}
function ef(a,b){for(var c={},d=0;d<b.length;++d){var e=b[d],f=null;if("video"==e.contentType){var h=a.o.getInitialVideoTrackId();if(null==h)continue;f=e.s.filter(function(a){return a.K==h});if(0==f.length)continue;f=f[0]}else if("audio"==e.contentType)if(h=a.o.getInitialAudioTrackId(),f=e.s.filter(function(a){return a.K==h}),0==f.length){f=e.s.filter(function(a){return a.ia&&a.U});if(0==f.length)continue;f=e.s[Math.floor(f.length/2)]}else f=f[0];else 0<e.s.length&&(f=e.s[0]);c[e.contentType]=f}return c}
function ff(a,b){var c={},d;for(d in b){var e=b[d],e="text"==d?new Ce(a,a.b):hf(a,e);if(!e)return Va(c).forEach(function(a){a.destroy()}),!1;c[d]=e}a.bb(a.eb);a.c=c;return!0}
function hf(a,b){var c=de(b),d=null,e=VideoPlayerShakaExperiments.useLocalEstimatorForAbrSampling?a.Lb:a.ca;if(a.rb)if(d=c.split(";")[0],d="v"===d.charAt(0)?"video":"a"===d.charAt(0)?"audio":null,"video"===d||"audio"===d&&VideoPlayerShakaExperiments.enableRequestPipeliningForVodAudios){var f=a.l[d];f||(f=new SegmentRequestManager(d,a.S()?VideoPriorityCalculator.calculateLive:VideoPriorityCalculator.calculate,a.m,e,a.cb),a.D&&f.updatePriorityWithNewAdjustment(a.D.getPriorityAdjustment()),a.l[d]=f);
d=f}else d=null;c=new je(a,a.b,a.i,c,e,a.fb,a.V,d);c.P(a.g);return c}function jf(a,b){a.b.currentTime=b;a.w=b}
function gf(a,b,c){a.Za=a.b.playbackRate;a.b.playbackRate=0;kf(a,c);var d;a.T&&a.T<=c.end&&a.T>=c.start?d=a.T:a.a.b?(d=c.end,a.Hb=!0):d=c.start;C(a.h,a.b,"seeking",a.ic.bind(a));C(a.h,a.b,"playing",a.Ya.bind(a,!0));VideoPlayerShakaExperiments.updatePriorityOnPlayEvent&&C(a.h,a.b,"play",a.Ya.bind(a,!0));C(a.h,a.b,"pause",a.Ya.bind(a,!1));C(a.h,a.b,"seeking",a.Ib.bind(a));C(a.h,a.b,"timeupdate",throttle(a.Ib.bind(a),VideoPlayerShakaExperiments.schedulerPriorityUpdateInterval));if(a.b.currentTime!=d)if(a.ob)0!==
a.b.readyState?jf(a,d):lf(a,d);else try{jf(a,d)}catch(e){lf(a,d)}mf(a,c.start,c.end);var f=[],h;for(h in a.c){c=a.c[h];H(a,function(a){f.push(a.Eb(this.$).then(H(this,function(b){var c=a.Ca();c>this.Ua&&(this.Ua=c);return b})))})(c);C(a.h,c,"ended",a.jc.bind(a));C(a.h,c,"should_nudge",a.fc.bind(a));d=b[h];var g=a.o.getInitialSwitchReason()||void 0;c.ya(d,!1,void 0,g)}Promise.all(f).then(a.Zb.bind(a)).catch(H(a,function(a){"destroy"!=a.type&&(a=y(a),this.dispatchEvent(a))}));vb(a,a.ha)}n.Ya=function(a){Object.keys(this.l).forEach(function(b){this.l[b].updatePriorityWithNewPlayingState(a)}.bind(this))};
n.Ib=function(){this.b&&Object.keys(this.l).forEach(function(a){this.l[a].updatePriorityWithNewPlayhead(this.b.currentTime)}.bind(this))};function lf(a,b){a.J=b;for(var c in a.c){var d=a.c[c];a.J&&(d.R=a.J)}}
n.Zb=function(a){ba(a&&a.length==Object.keys(this.c).length);for(var b=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=0;d<a.length;++d)var e=a[d],b=Math.min(b,e),c=Math.max(c,e);a=Xe(this);for(d=0;d<a.length;++d)a[d].ma(c);nf(this,a,c);var f=Va(this.c).map(function(a){return a.ta().id});VideoPlayerShakaExperiments.sequentiallyLoadStreams?of(this,f,c):(d=$a(this.f).map(function(a){return a.s}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return!~f.indexOf(a.id)}).map(function(a){var b=
[a.I.Aa?a.I.Aa():a.I.create()];a.M&&b.push(a.M.create(this.m,this.V));return Promise.all(b)}),Promise.all(d).then(H(this,function(a){for(var b=0;b<a.length;++b)a[b][0].ma(c);this.pa=!0;pf(this)})).catch(H(this,function(a){"aborted"!=a.type&&(a=y(a),this.dispatchEvent(a))})))};
function of(a,b,c){var d=Promise.resolve();$a(a.f).map(function(a){return a.s}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return!~b.indexOf(a.id)}).forEach(function(a){d=d.then(H(this,function(b){b&&b[0].ma(c);b=[a.I.Aa?a.I.Aa():a.I.create()];a.M&&b.push(a.M.create(this.m,this.V));return Promise.all(b)})).catch(function(a){throw a;})});d.then(H(a,function(){this.pa=!0;pf(this)})).catch(H(a,function(a){"aborted"!=a.type&&(a=y(a),this.dispatchEvent(a))}))}
function pf(a){for(var b in a.u){var c=a.u[b];a.c[b].ya(c.Fb,c.hb,c.ib,c.switchReason)}a.u={}}function nf(a,b,c){if(b=$e(a,b))kf(a,b),mf(a,b.start,b.end);if(0!=c)b=a.b.currentTime+c,a.b.currentTime=b,a.w=b;else if(a.Hb&&b){c=b.end;if(a.Ab){var d=a.b.currentTime;d>=b.start&&d<=b.end&&d<c&&(c=d)}b=c;Math.abs(b-a.b.currentTime)>=a.Gb&&(a.b.currentTime=b)}a.b.playbackRate=a.Za;a.a.b&&null!=a.a.f&&cf(a,0);qf(a);a.$.resolve()}
function kf(a,b){if(a.a.b)isNaN(a.i.duration)&&(a.i.duration=b.end+2592E3);else if(isNaN(a.i.duration)||b.end>a.i.duration){a.i.duration=b.end;for(var c=0;c<a.i.sourceBuffers.length;++c)a.i.sourceBuffers[c].appendWindowEnd=b.end}}n.kc=function(){this.P=null;qf(this);var a=$e(this,Xe(this));a&&(this.a.b&&this.O!=a.v&&(this.O=a.v,null!=this.A&&(clearTimeout(this.A),this.A=null)),mf(this,a.start,a.end),this.b.paused||rf(this,this.b.currentTime,a.start,a.end))};
function mf(a,b,c){b=x({type:"seekrangechanged",bubbles:!0,start:b,end:c});a.dispatchEvent(b)}n.ic=function(){var a=this.b.currentTime;if(null!=this.w){if(a>=this.w-.01&&a<=this.w+.01){this.w=null;return}this.w=null}var b=$e(this,Xe(this));if(b){var c=b.start,b=b.end;VideoPlayerShakaExperiments.skipRemainingBufferedOnStreamEnd&&this.a.b&&this.a.h&&this.b.paused&&(b=this.O);(c=rf(this,a,c,b))||(c=b,a<=c+.01||this.a.b&&!sf(this,c)?c=!1:(this.b.currentTime=c,c=!0));if(!c)for(var d in this.c)this.c[d].zb()}};
function rf(a,b,c,d){if(b>=c-.01)return!1;b=0;a.a.b&&(b=.5,sf(a,c+b)||(b=a.a.c));a.b.currentTime=Math.min(c+b,d);return!0}function sf(a,b){for(var c in a.c)if(!a.c[c].Cb(b))return!1;return!0}n.jc=function(){if(!this.a.b){for(var a in this.c)if(!this.c[a].Ta())return;this.Ba()}};n.fc=function(){VideoPlayerShakaExperiments.ignoreSeekWhenNudging&&(this.w=this.b.currentTime);this.b.currentTime+=.001};
n.lb=function(){var a=this.a,b=null,c=null;a&&a.a&&a.a[0]&&(b=a.a[0]);b&&b.a&&b.a[0]&&(c=b.a[0]);return!!c&&c.b};Y.prototype.hasInlinedCea608Subtitles=Y.prototype.lb;Y.prototype.bb=function(a){this.eb=a;var b=this.c;"video"in b&&(b.video.b.J=a&&this.lb())};Y.prototype.setEnableCea608Parsing=Y.prototype.bb;function yb(a){return a.a.h&&a.b.currentTime+.5>a.O?!0:!1}n=Y.prototype;
n.ac=function(){this.ba=!0;if(yb(this))return this.Ba();Va(this.c).every(function(a){return a.Ta()})&&(this.A=setTimeout(this.Ba.bind(this),1E3*this.Kb))};n.$b=function(){this.ba=!1;null!=this.A&&(clearTimeout(this.A),this.A=null)};n.cc=function(){null!==this.J&&(jf(this,this.J),lf(this,null))};n.qc=function(){};n.Ba=function(){this.ba=!1;this.A=null;this.i.endOfStream()};function Xe(a){return Va(a.c).map(function(a){return a.Ra()}).filter(function(a){return null!=a})}
function Ze(a){return Math.max(a.a?a.a.c:1,a.xb?a.g.streamBufferSize||0:0)}
function $e(a,b){for(var c=0,d=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,f=0;f<b.length;++f){var h=b[f].Qa(),c=Math.max(c,h.start);null!=h.end&&(d=Math.min(d,h.end));b[f].length()&&(e=Math.min(e,b[f].v().endTime))}if(d==Number.POSITIVE_INFINITY)if(d=a.a.a[0],d.duration)d=(d.start||0)+d.duration;else return null;a.a.b&&(f=Ze(a),d=Math.max(d-f,c));if(c>d)return null;d=Math.floor(1E5*d)/1E5;return{start:c,end:d,v:e}}function qf(a){a.a.b&&(a.P=setTimeout(a.kc.bind(a),1E3))}
function Te(a){for(var b in a.c)a.c[b].P(a.g)}n.Ca=function(){return this.Ua};Y.prototype.getLongestInitResponseTime=Y.prototype.Ca;function Z(a,b,c,d){c||(c=new I);d||(d=new X);Y.call(this,null,c,d);"string"===typeof a?this.Nb=a:this.Oa=a;this.G=null;this.aa=b;this.qa=[];this.mb=[];this.nb=[];this.xa=0;this.H=null}q(Z,Y);p("shaka.player.DashVideoSource",Z);Z.prototype.Wb=function(a){this.G=a;this.Xa(!0,!0)};Z.prototype.updateManifest=Z.prototype.Wb;Z.prototype.pb=function(){return this.Oa||this.G};Z.prototype.debugGetManifest=Z.prototype.pb;Z.prototype.Tb=function(a,b,c){this.qa.push(a);this.mb.push(b||"");this.nb.push(c||"")};
Z.prototype.addExternalCaptions=Z.prototype.Tb;Z.prototype.Ub=function(a){this.H=a};Z.prototype.setNetworkCallback=Z.prototype.Ub;Z.prototype.destroy=function(){this.G=this.H=this.aa=null;Y.prototype.destroy.call(this)};
Z.prototype.Ea=function(){var a;this.m&&(a=this.m.getOperationLogger("source_load").start());var b,c=H(this,function(c){this.ja("MPDFetchDuration",(Date.now()-b)/1E3);this.G=c;for(var d=0;d<this.qa.length;d++)Vc(c,this.qa[d],this.mb[d],this.nb[d]);this.a=He(new Ge(this.aa,this.m),c,this.H);return Y.prototype.Ea.call(this).then(function(){a&&a.log()})});if(this.Oa)return b=Date.now(),c(this.Oa);var d=[new L(this.Nb)],e;if(this.Ka){var f=new VideoPushParametersHelper(this.Nb);f.setStreamEndOffset(Ze(this));
this.Ia&&f.setPushVideoRepresentationID(this.Ia);this.Z&&f.setPushAudioRepresentationID(this.Z);this.Y&&f.setUseLongCacheForManifest(this.Y);e=new vd(null);e.a=f}d=new K(this.H,d);e=new td(d,this.Na,e,this.V);b=Date.now();return ud(e,this.m).then(c)};
Z.prototype.kb=function(){if(this.qb){var a=this.a;if(a=(a=a&&a.a)&&a[0]){var a=a.a.reduce(function(a,b){return a.concat(b.s)},[]),b=function(a){return null!=a};Promise.all(a.map(function(a){a=a.I;return a.Xb?a.la:a.create()})).then(function(a){a=a.filter(b);this.ja("InitialSegmentIndexes",a)}.bind(this));Promise.all(a.map(function(a){return a.M})).then(function(a){a=a.filter(b);this.ja("SegmentInitSources",a)}.bind(this))}}};
Z.prototype.tb=function(a,b,c){if(this.b.paused&&this.xa+1E4>Date.now()&&this.a)return Promise.reject({type:"delay"});var d;if(b&&void 0!=c)d=new vd(b),d.f=c,b=df(this),null!=b&&(d.c=b.streamInfoID,d.b=this.Z);else for(b=a.c,c=0;c<b.length;c++){var e=new VideoPushParametersHelper(b[c].toString());this.Y&&e.setUseLongCacheForManifest(this.Y);b[c]=new L(e.getURL())}a=new td(a,this.Na,d,this.V);var f=Date.now();return ud(a,this.m).then(H(this,function(a){this.xa=Date.now();this.ja("MPDFetchDuration",
(this.xa-f)/1E3);this.G=a;a=He(new Ge(this.aa,this.m),a,this.H);return Promise.resolve(a)}))};Z.prototype.sb=function(){var a=He(new Ge(this.aa),this.G,this.H);return Promise.resolve(a)};}.bind(g, global))();

module.exports = g.shaka;


/* H0msb0NcR2f */}),null);