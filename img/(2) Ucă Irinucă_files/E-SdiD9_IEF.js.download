if (self.CavalryLogger) { CavalryLogger.start_js(["YeNLZ"]); }

__d("MessengerThreadsWebGraphQLQuery",["WebGraphQLQueryBase"],(function a(b,c,d,e,f,g){'use strict';f.exports=function(){var h,i;h=babelHelpers.inherits(j,c("WebGraphQLQueryBase"));i=h&&h.prototype;j.__getDocID=function(){"use strict";return "1467512603342928"};j.getQueryID=function(){"use strict";return "479979239028406"};function j(){"use strict";h.apply(this,arguments)}return j}()}),null);
__d('messengerReadReceiptTransformerRe',['bs_array','bs_caml_format'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k={};c('bs_array').iter(function(l){var m=l.actor;if(!(m==null)&&i!==m.id){k[m.id]={action:c('bs_caml_format').caml_float_of_string(l.action),watermark:c('bs_caml_format').caml_float_of_string(l.watermark)};return 0}else return 0;},j.nodes);return k}g.transformReadReceipt=h}),null);
__d('messengerThreadTransformerRe',['URI','bs_array','bs_string','bs_caml_array','bs_js_boolean','MercuryIDs','bs_caml_format','bs_js_primitive','bs_js_null_undefined','MessagingThreadType','messengerAttachmentTransformerRe','MessengerThreadCannotReplyReason'],(function a(b,c,d,e,f,g){'use strict';function h(t){var u=t.location_coordinates,v=u==null?[null,null]:[u.latitude,u.longitude],w=t.location_page,x;if(w==null){x=null}else{var y=w.address;x=y==null?null:y.full_address}var z=t.allows_rsvp,aa=z!==0?1:0,ba=c('bs_array').fold_left(function(da,ea){da[ea.node.id]=ea.guest_list_state;return da},{},t.event_reminder_members.edges),ca=t.lightweight_event_creator;return {creator_id:ca==null?null:ca.id,event_members:ba,event_time:t.time,event_type:t.lightweight_event_type,latitude:v[0],longitude:v[1],location_address:x,location_name:t.location_name,note:t.note,oid:t.id,related_event:t.related_event,repeat_mode:t.repeat_mode,seconds_to_notify_before:t.seconds_to_notify_before,status:t.lightweight_event_status,title:t.event_title,track_rsvp:aa}}function i(t){var u=t.associated_object;if(u==null){return null}else{var v=u.action_link,w=u.profile_picture;return {id:u.id,name:u.name,action_link:v==null?null:new (c('URI'))(v).setDomain("www.facebook.com"),profile_picture:w==null?null:{uri:w.uri},room_type:u.room_type,privacy_mode:u.privacy_mode,approval_mode_toggleable:u.approval_mode_toggleable}}}function j(t){var u=t.related_page_thread;if(u==null){return null}else{var v=u.page,w=v==null?[]:c('bs_array').map(function(x){return x.name},v.custom_tags.nodes);return {flagged:u.is_flagged,customTagNames:w}}}function k(t){var u=t.thread_key.other_user_id;if(u==null){return 0}else{var v=t.all_participants.nodes;return c('bs_array').fold_left(function(w,x){var y=x.messaging_actor;if(y.id===u){return +(y.__typename==="User")}else return w;},0,v)}}function l(t){if(t.length){var u={};c('bs_array').iter(function(v){var w=v.nickname;if(w==null){return 0}else{u[v.participant_id]=w;return 0}},t);return u}else return null;}function m(t){if(!(t==null)&&t!==""){return "#"+c('bs_string').sub(t,2,t.length-2|0)}else return null;}function n(t){if(t==null){return null}else{var u={};c('bs_array').iter(function(v){u[v.participant_id]=v.days_active;return 0},t);return u}}function o(t){if(t==null){return null}else{var u={};c('bs_array').iter(function(v){u[v.participant_id]=v.participant_message_count;return 0},t);return u}}function p(t){if(t==null){return null}else{var u={};c('bs_array').iter(function(v){u[v.participant_id]=v.reacted_to_count;return 0},t);return u}}function q(t){if(t==null){return null}else return t;}function r(t){return c('bs_caml_array').caml_array_get(t,0)}function s(t,u,v){var w=u.customization_info,x;if(w==null){x=[null,null,null]}else{var y=w.emoji;x=[m(w.outgoing_bubble_color),y==null?null:{emoji:y},l(w.participant_customizations)]}var z=u.thread_streak_data,aa=z==null?[null,null,null]:[q(z.days_in_streak),q(z.streak_reciprocation_timestamp),q(z.streak_begin_timestamp)],ba=u.page_comm_item,ca=ba==null?[null,null,null]:[ba.comm_status,ba.comm_source_id,ba.id],da=u.last_message.nodes.length?[c('bs_caml_array').caml_array_get(u.last_message.nodes,0)]:0,ea=u.last_read_receipt.nodes.length?[c('bs_caml_array').caml_array_get(u.last_read_receipt.nodes,0)]:0,fa;if(da){var ga=da[0];fa=c('messengerAttachmentTransformerRe').transformAttachment(t,{extensible_attachment:ga.extensible_attachment,blob_attachments:ga.blob_attachments,sticker:ga.sticker},v)}else fa=[];var ha=u.cannot_reply_reason,ia=u.thread_queue_metadata,ja=u.thread_type,ka=u.montage_thread,la=u.image,ma=u.thread_key.other_user_id,na=u.thread_queue_metadata,oa=u.name,pa=u.thread_key.other_user_id,qa;if(pa==null){var ra=u.thread_key.thread_fbid;qa=ra==null?u.thread_key.legacy_thread_id:ra}else qa=pa;var sa=u.thread_key.legacy_thread_id,ta=u.rtc_call_data,ua;if(ta==null){ua=null}else{var va=ta.initiator;ua={call_state:ta.call_state,server_info_data:ta.server_info_data,initiator_fbid:va==null?0:c('bs_caml_format').caml_float_of_string(va.id)}}return {admin_ids:c('bs_array').map(function(wa){return wa.id},u.thread_admins),approval_mode:u.approval_mode,approval_queue_ids:ia==null?[]:c('bs_array').map(function(wa){return c('MercuryIDs').getParticipantIDFromUserID(wa.id)},ia.approval_requests.nodes),can_reply:ha==null?true:false,cannot_reply_reason:u.cannot_reply_reason,custom_color:x[0],custom_like_icon:x[1],custom_nickname:x[2],customization_enabled:u.customization_enabled,days_in_streak:aa[0],thread_type:ja==null?null:c('bs_js_null_undefined').from_opt(c('bs_js_primitive').undefined_to_opt(c('MessagingThreadType')[ja])),participant_add_mode:u.participant_add_mode_as_string,ephemeral_ttl_mode:u.ephemeral_ttl_mode,folder:c('bs_string').lowercase(u.folder),has_email_participant:ha==null?false:c('bs_js_boolean').to_js_boolean(+(ha===c('MessengerThreadCannotReplyReason').HAS_EMAIL_PARTICIPANT)),has_montage:ka==null?false:true,image_src:la==null?null:la.uri,is_archived:c('bs_js_boolean').to_js_boolean(u.has_viewer_archived),is_canonical_user:c('bs_js_boolean').to_js_boolean(k(u)),is_canonical:ma==null?false:true,is_pin_protected:c('bs_js_boolean').to_js_boolean(u.is_pin_protected),is_subscribed:c('bs_js_boolean').to_js_boolean(u.is_viewer_subscribed),is_thread_queue_enabled:na==null?false:true,joinable_mode:{mode:c('bs_caml_format').caml_int_of_string(u.joinable_mode.mode),link:u.joinable_mode.link},last_message_timestamp:da?c('bs_caml_format').caml_float_of_string(da[0].timestamp_precise):0,last_message_type:da?da[0].commerce_message_type:null,last_read_timestamp:ea?c('bs_caml_format').caml_float_of_string(ea[0].timestamp_precise):0,lightweight_event:u.event_reminders.nodes.length?h(c('bs_caml_array').caml_array_get(u.event_reminders.nodes,0)):null,message_count:u.message_count,mute_until:u.mute_until,name:oa==null?"":oa,other_user_fbid:u.thread_key.other_user_id,page_thread_info:j(u),participants:c('bs_array').map(function(wa){return c('MercuryIDs').getParticipantIDFromUserID(wa.messaging_actor.id)},u.all_participants.nodes),participant_days_active:n(u.participant_days_active),participant_message_counts:o(u.participant_message_counts),participant_reacted_to_counts:p(u.participant_reacted_to_counts),read_only:ha==null?false:c('bs_js_boolean').to_js_boolean(+(ha===c('MessengerThreadCannotReplyReason').READ_ONLY)),recipients_loadable:ha==null?true:c('bs_js_boolean').to_js_boolean(+(ha!==c('MessengerThreadCannotReplyReason').RECIPIENTS_NOT_LOADABLE)),server_timestamp:c('bs_caml_format').caml_float_of_string(u.updated_time_precise),snippet_attachments:fa,snippet_sender:da?c('MercuryIDs').getParticipantIDFromUserID(da[0].message_sender.messaging_actor.id):null,snippet:da?da[0].snippet:null,streak_begin_ts:aa[2],streak_reciprocation_ts:aa[1],thread_fbid:qa,thread_id:sa==null?"":sa,timestamp:c('bs_caml_format').caml_float_of_string(u.updated_time_precise),top_emojis:u.top_emojis,unread_count:u.unread_count,rtc_call_data:ua,associated_object:i(u),reactions_mute_mode:u.reactions_mute_mode==="REACTIONS_NOT_MUTED"?0:1,mentions_mute_mode:u.mentions_mute_mode==="MENTIONS_NOT_MUTED"?0:1,comm_status:ca[0],page_comm_item_id:ca[2],comm_source_id:ca[1]}}g._getLightweightEvent=h;g._getAssociatedObject=i;g._getPageThreadInfo=j;g._getIsCanonicalUser=k;g._getNicknames=l;g._getCustomColor=m;g._getParticipantDaysActive=n;g._getParticipantMessageCounts=o;g._getParticipantReactedToCounts=p;g._getStreakRelatedData=q;g.indexZero=r;g.transformThread=s}),null);
__d('messengerGraphQLThreadFetcherRe',['Promise','bs_array','getByPath','bs_caml_array','bs_pervasives','WebGraphQL','messengerThreadTransformerRe','messengerMessageTransformerRe','MessengerThreadsWebGraphQLQuery','messengerReadReceiptTransformerRe'],(function a(b,c,d,e,f,g){'use strict';function h(l,m,n){var o=c('bs_array').map(function(p){var q=c('messengerMessageTransformerRe').unsafeCastBlobAttachments(p),r=p.extensible_attachment,s;if(r==null){s=null}else{var t=r.story_attachment;s={legacy_attachment_id:r.legacy_attachment_id,story_attachment:t==null?null:c('messengerMessageTransformerRe').unsafeCastExtensibleAttachment(t)}}return {snippet:p.snippet,message_sender:p.message_sender,timestamp_precise:p.timestamp_precise,commerce_message_type:p.commerce_message_type,extensible_attachment:s,blob_attachments:q,sticker:p.sticker}},m.last_message.nodes);return c('messengerThreadTransformerRe').transformThread(l,{thread_key:m.thread_key,name:m.name,all_participants:m.all_participants,last_message:{nodes:o},unread_count:m.unread_count,message_count:m.messages_count,image:m.image,updated_time_precise:m.updated_time_precise,mute_until:m.mute_until,is_pin_protected:m.is_pin_protected,is_viewer_subscribed:m.is_viewer_subscribed,thread_queue_enabled:m.thread_queue_enabled,folder:m.folder,has_viewer_archived:m.has_viewer_archived,cannot_reply_reason:m.cannot_reply_reason,ephemeral_ttl_mode:m.ephemeral_ttl_mode,customization_info:m.customization_info,thread_admins:m.thread_admins,approval_mode:m.approval_mode,joinable_mode:m.joinable_mode,thread_queue_metadata:m.thread_queue_metadata,event_reminders:m.event_reminders,montage_thread:m.montage_thread,last_read_receipt:m.last_read_receipt,related_page_thread:m.related_page_thread,rtc_call_data:m.rtc_call_data,associated_object:m.associated_object,reactions_mute_mode:m.reactions_mute_mode,mentions_mute_mode:m.mentions_mute_mode,privacy_mode:m.privacy_mode,customization_enabled:m.customization_enabled,thread_type:m.thread_type,participant_add_mode_as_string:m.participant_add_mode_as_string,top_emojis:m.top_emojis,participant_days_active:m.participant_days_active,participant_message_counts:m.participant_message_counts,participant_reacted_to_counts:m.participant_reacted_to_counts,thread_streak_data:m.thread_streak_data,page_comm_item:m.page_comm_item},n)}function i(l,m,n,o,p){if(l==null){if(o!==0){return {actions:null,thread:undefined,end_of_history:{type:"user",fbid:m},roger:null}}else return {actions:null,thread:undefined,end_of_history:undefined,roger:null};}else{var q=l.thread_key.other_user_id,r=l.thread_key.thread_fbid,s=l.thread_key.legacy_thread_id,t=q==null?r==null?s==null?c('bs_pervasives').failwith("No thread ID"):s:r:q;if(t!==m)c('bs_pervasives').failwith("Thread ID mismatch");var u=h(n,l,p),v=l.messages,w=v==null?null:c('bs_array').map(function(ba){return c('messengerMessageTransformerRe').transformMessage(n,ba,{thread_id:l.thread_key.legacy_thread_id,thread_fbid:l.thread_key.thread_fbid,other_user_fbid:l.thread_key.other_user_id,folder:u.folder},p)},v.nodes),x=l.read_receipts,y;if(x==null){y=null}else{var z={};z[m]=c('messengerReadReceiptTransformerRe').transformReadReceipt(n,x);y=z}var aa=c('getByPath')(l,["messages","page_info"]);if(aa==null){return {actions:w,thread:u,end_of_history:undefined,roger:y}}else if(aa.has_previous_page){return {actions:w,thread:u,end_of_history:undefined,roger:y}}else return {actions:w,thread:u,end_of_history:{type:"thread",fbid:m},roger:y};}}function j(l){return new (c('MessengerThreadsWebGraphQLQuery'))({id:l.id,message_limit:l.limit,load_messages:+(l.limit>0),load_read_receipts:l.loadReadReceipts,before:l.timestamp})}function k(l,m,n){var o=c('bs_array').map(j,m);return c('Promise').all(c('WebGraphQL').execAll(o,{actorID:n?l:null})).then(function(p){return c('bs_array').mapi(function(q,r){var s=r.message_thread,t=c('bs_caml_array').caml_array_get(m,q);return i(s,t.id,l,t.isCanonical,n)},p)})}g.transformThread=h;g._transformPayload=i;g._getQuery=j;g.fetchAll=k}),null);